<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PooreYouTuber - Website Booster</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #d9534f;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
        }
        .page-entry-group {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: #fafafa;
        }
        .page-entry {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .page-entry input[type="text"] {
            flex-grow: 1;
            margin-bottom: 0;
        }
        .page-entry input[type="number"] {
            width: 80px;
            text-align: right;
            margin-bottom: 0;
        }
        .percent-label {
            font-weight: bold;
            color: #777;
            width: 15px;
        }
        .total-percent-display {
            font-size: 1.1em;
            font-weight: bold;
            text-align: right;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        .total-percent-display span {
            margin-left: 5px;
        }
        #message {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
            display: none; /* Initially hidden */
        }
        #message.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
            display: block;
        }
        #message.error {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
            display: block;
        }
        #message.info {
            background-color: #cce5ff;
            color: #004085;
            border-color: #b8daff;
            display: block;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #d9534f;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover:not(:disabled) {
            background-color: #c9302c;
        }
        button:disabled {
            background-color: #ea9391;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸš€ Website Traffic Booster (GA4)</h1>
    <p style="text-align: center; color: #888;">
        Distribute views across multiple pages and countries. Total percentage must equal 100% for both sections.
    </p>
    <form id="boosterForm">
        <div class="input-group">
            <label for="gaid">1. GA4 Measurement ID (e.g., G-XXXXXXX):</label>
            <input type="text" id="gaid" placeholder="Enter GA4 Measurement ID" required autocomplete="off">
        </div>
        <div class="input-group">
            <label for="apikey">2. GA4 API Secret:</label>
            <input type="text" id="apikey" placeholder="Enter GA4 API Secret" required autocomplete="off">
        </div>
        <div class="input-group">
            <label for="views">3. Total Views to Generate (Max 500):</label>
            <input type="number" id="views" value="100" min="1" max="500" required>
        </div>

        <div class="page-entry-group">
            <label style="color: #5cb85c;">4. Distribute Traffic Across Pages (Total must be 100%):</label>
            <p style="font-size: 0.85em; color: #888; margin-bottom: 10px;">Enter full URLs (https://...).</p>
            
            <div class="page-entry">
                <input type="text" id="url1" placeholder="Page URL (Required)" required>
                <input type="number" id="percent1" class="page-percent" value="100" min="0" max="100" required>
                <span class="percent-label">%</span>
            </div>

            <div class="page-entry">
                <input type="text" id="url2" placeholder="Page URL (Optional)">
                <input type="number" id="percent2" class="page-percent" value="0" min="0" max="100" required>
                <span class="percent-label">%</span>
            </div>

            <div class="page-entry">
                <input type="text" id="url3" placeholder="Page URL (Optional)">
                <input type="number" id="percent3" class="page-percent" value="0" min="0" max="100" required>
                <span class="percent-label">%</span>
            </div>
            
            <p class="total-percent-display">
                Total Page Distribution: <span id="totalPercent" style="color:#5cb85c;">100</span>%
            </p>
        </div>
        <div class="page-entry-group">
            <label style="color: #d9534f;">5. Distribute Traffic Across Countries (Total must be 100%):</label>
            <p style="font-size: 0.85em; color: #888; margin-bottom: 10px;">Use 2-letter ISO codes (e.g., US, IN, GB, DE).</p>
            
            <div class="page-entry">
                <input type="text" id="countryCode1" class="country-code" placeholder="Country Code (e.g., US)" maxlength="2" required style="text-transform: uppercase;">
                <input type="number" id="countryPercent1" class="country-percent" value="100" min="0" max="100" required>
                <span class="percent-label">%</span>
            </div>

            <div class="page-entry">
                <input type="text" id="countryCode2" class="country-code" placeholder="Country Code (e.g., IN)">
                <input type="number" id="countryPercent2" class="country-percent" value="0" min="0" max="100" required>
                <span class="percent-label">%</span>
            </div>

            <div class="page-entry">
                <input type="text" id="countryCode3" class="country-code" placeholder="Country Code (e.g., DE)">
                <input type="number" id="countryPercent3" class="country-percent" value="0" min="0" max="100" required>
                <span class="percent-label">%</span>
            </div>
            
            <p class="total-percent-display">
                Total Country Distribution: <span id="totalCountryPercent" style="color:#d9534f;">100</span>%
            </p>
        </div>
        <div id="message" class="info"></div>
        
        <button type="submit" id="submitBtn">Generate Traffic and Close Browser</button>
    </form>
</div>

<script>
    // ------------------------------------------------------------------------------------
    // --- WEBSITE BOOSTER JAVASCRIPT LOGIC (FINAL) ---
    // ------------------------------------------------------------------------------------
    // IMPORTANT: Apne Render URL ko yahan verify karein.
    const RENDER_API_URL = 'https://pooreyoutuber-github-io.onrender.com/boost-mp'; 
    const STORAGE_KEY = 'booster_details_v7'; 
    
    const form = document.getElementById('boosterForm');
    const messageDiv = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');
    
    // Page Distribution Variables
    const totalPercentSpan = document.getElementById('totalPercent'); 
    const pageInputs = [1, 2, 3].map(i => ({ // Reduced to 3 for simplicity, match your HTML
        url: document.getElementById(`url${i}`),
        percent: document.getElementById(`percent${i}`)
    }));
    
    // Country Distribution Variables
    const totalCountryPercentSpan = document.getElementById('totalCountryPercent');
    const countryInputs = [1, 2, 3].map(i => ({ 
        code: document.getElementById(`countryCode${i}`),
        percent: document.getElementById(`countryPercent${i}`)
    }));


    // --- Local Storage Functions ---
    function loadSavedDetails() {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
            try {
                const data = JSON.parse(savedData);
                document.getElementById('gaid').value = data.gaid || '';
                document.getElementById('apikey').value = data.apikey || '';
                document.getElementById('views').value = data.views || '100';
                
                // Load Pages
                data.pages.forEach((page, index) => {
                    if (index < pageInputs.length) {
                        pageInputs[index].url.value = page.url || '';
                        pageInputs[index].percent.value = page.percent || '0';
                    }
                });
                
                // Load Countries
                data.countries.forEach((country, index) => {
                    if (index < countryInputs.length) {
                        countryInputs[index].code.value = country.code || '';
                        countryInputs[index].percent.value = country.percent || '0';
                    }
                });

            } catch (e) { /* Error ignored */ }
            updateDisplayTotalPages();
            updateDisplayTotalCountry();
        }
    }

    function saveDetails(gaid, apikey, views, pages, countries) {
        const data = { gaid, apikey, views, pages, countries };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // --- UI Functions ---
    function updateDisplayTotalPages() {
        let total = 0;
        document.querySelectorAll('.page-percent').forEach(input => {
            total += parseInt(input.value) || 0; 
        });
        totalPercentSpan.textContent = total;
        totalPercentSpan.style.color = total === 100 ? '#5cb85c' : '#d9534f';
        return total;
    }
    document.querySelectorAll('.page-percent').forEach(input => {
        input.addEventListener('input', updateDisplayTotalPages);
    });

    function updateDisplayTotalCountry() {
        let total = 0;
        document.querySelectorAll('.country-percent').forEach(input => {
            // Ensure we only sum up if a code is present or it's a non-zero percent
            if (input.previousElementSibling.value.trim() || parseInt(input.value) > 0) {
                 total += parseInt(input.value) || 0; 
            }
        });
        totalCountryPercentSpan.textContent = total;
        totalCountryPercentSpan.style.color = total === 100 ? '#5cb85c' : '#d9534f';
        return total;
    }
    document.querySelectorAll('.country-percent').forEach(input => {
        input.addEventListener('input', updateDisplayTotalCountry);
    });
    document.querySelectorAll('.country-code').forEach(input => {
        input.addEventListener('input', updateDisplayTotalCountry);
    });


    function showMessage(type, message, reenable) {
        messageDiv.className = type;
        messageDiv.innerHTML = message;
        if (reenable) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Generate Traffic and Close Browser';
        }
    }

    // ------------------------------------------------------------------------------------
    // --- MAIN SUBMISSION LOGIC ---
    // ------------------------------------------------------------------------------------
    form.addEventListener('submit', function(event) {
        event.preventDefault();
        
        const gaId = document.getElementById('gaid').value.trim();
        const apiKey = document.getElementById('apikey').value.trim();
        let viewsCount = parseInt(document.getElementById('views').value);
        
        if (!gaId || !apiKey || viewsCount < 1) {
            showMessage('error', 'âŒ Error: GA Keys, API Secret, and Total Views are required.', true);
            return;
        }

        // --- VALIDATION: 100% Checks ---
        const pageTotalPercent = updateDisplayTotalPages();
        const countryTotalPercent = updateDisplayTotalCountry();

        if (pageTotalPercent !== 100) {
            showMessage('error', `âŒ Error: Page distribution must be 100%, but it is ${pageTotalPercent}%.`, true);
            return;
        }

        if (countryTotalPercent !== 100) {
            showMessage('error', `âŒ Error: Country distribution must be 100%, but it is ${countryTotalPercent}%.`, true);
            return;
        }

        // --- Collect Pages Data ---
        let pages = [];
        let isValidPageData = true;
        pageInputs.forEach(input => {
            const url = input.url.value.trim();
            const percent = parseInt(input.percent.value) || 0;
            if (url && percent > 0) {
                if (!url.startsWith('http')) {
                    showMessage('error', 'âŒ Error: All page URLs must start with http:// or https://', true);
                    isValidPageData = false;
                    return;
                }
                pages.push({ url: url, percent: percent });
            }
        });

        // --- Collect Countries Data ---
        let countries = [];
        let isValidCountryData = true;
        countryInputs.forEach(input => {
            const code = input.code.value.trim();
            const percent = parseInt(input.percent.value) || 0;
            if (code && percent > 0) {
                if (code.length !== 2) {
                    showMessage('error', 'âŒ Error: All Country Codes must be exactly 2 letters (e.g., US, IN).', true);
                    isValidCountryData = false;
                    return;
                }
                countries.push({ code: code.toUpperCase(), percent: percent });
            } else if (!code && percent > 0) {
                showMessage('error', 'âŒ Error: Percentage is > 0 but Country Code is missing.', true);
                isValidCountryData = false;
                return;
            }
        });
        
        if (!isValidPageData || !isValidCountryData || pages.length === 0 || countries.length === 0) {
            showMessage('error', 'âŒ Error: Please check all URL/Country Code formats and percentages (must be > 0).', true);
            return;
        }

        saveDetails(gaId, apiKey, viewsCount, pages, countries); 
        
        const payload = { 
            ga_id: gaId, 
            api_key: apiKey, 
            views: viewsCount, 
            pages: pages,
            countries: countries 
        };
        
        submitData(payload, 2); 
    });

    // --- Core Data Submission with Retry Logic ---
    async function submitData(data, retriesLeft) {
        submitBtn.disabled = true;
        
        if (retriesLeft < 2) {
            submitBtn.textContent = `âš ï¸ Pinging server... Retrying in 5 seconds...`;
            showMessage('info', `âš ï¸ Server is waking up. Retrying in 5 seconds...`, false);
            await new Promise(resolve => setTimeout(resolve, 5000));
        } else {
            submitBtn.textContent = 'âœ… Request initiated. Checking server status...';
            showMessage('info', 'âœ… Request initiated. Checking server status...', false);
        }
        
        try {
            const response = await fetch(RENDER_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const responseData = await response.json();

            if (responseData.status === 'accepted') {
                showMessage('success', `âœ¨ Success! ${responseData.message}. **Results expected within 24-48 hours.** You can close this browser now.`, true);
            } 
            else if (responseData.status === 'error') {
                showMessage('error', `âŒ API Error: ${responseData.message || 'Unknown error. Check server logs.'}.`, true);
            }
            else {
                 showMessage('error', `âŒ Server Error: HTTP Status ${response.status}. Message: ${responseData.message || JSON.stringify(responseData)}`, true);
            }

        } catch (error) {
            if (retriesLeft > 0) {
                return submitData(data, retriesLeft - 1);
            } else {
                showMessage('error', `âŒ Final Connection Error (3 attempts). Ensure your API service is LIVE and the URL is correct.`, true);
            }
        } 
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadSavedDetails();
        updateDisplayTotalPages();
        updateDisplayTotalCountry();
    });
</script>

</body>
</html>
