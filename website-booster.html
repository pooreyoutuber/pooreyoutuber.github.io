<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20-Slot Traffic Booster (Final UI)</title>
    <style>
        /* Base Styling */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f0f4f8; 
            color: #2c3e50; 
            margin: 0; 
            padding: 20px; 
            min-height: 100vh;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto;
            background: #ffffff; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); 
        }
        h1 { 
            text-align: center; 
            color: #3498db; 
            margin-bottom: 25px; 
            font-size: 2.5em;
        }

        /* Input Area */
        .input-area {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        .form-group {
            flex-grow: 1;
            min-width: 150px;
        }
        input[type="url"], input[type="number"] { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #bdc3c7; 
            border-radius: 6px; 
            box-sizing: border-box; 
        }
        #submitBtn { 
            padding: 10px 25px; 
            background-color: #2ecc71; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-size: 1em; 
            cursor: pointer; 
            transition: background-color 0.3s; 
            flex-shrink: 0; /* Prevents button from shrinking */
        }
        #submitBtn:hover:not(:disabled) { background-color: #27ae60; }
        #submitBtn:disabled { background-color: #95a5a6; cursor: not-allowed; }

        /* Status & Progress */
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 2px solid #3498db;
            margin-bottom: 15px;
        }
        .status-header h3 {
            margin: 0;
            color: #3498db;
            font-size: 1.3em;
        }
        .progress-bar {
            background-color: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            width: 70%;
            height: 20px;
            margin-left: 20px;
        }
        .progress-fill {
            height: 100%;
            background-color: #2ecc71;
            transition: width 0.3s;
            text-align: center;
            color: white;
            font-size: 0.9em;
            line-height: 20px;
        }

        /* Slots Grid */
        #slots-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        .slot {
            background-color: #ecf0f1;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-left: 5px solid #3498db; /* Initial Blue */
            transition: border-left 0.5s;
        }
        .slot-title {
            font-weight: 700;
            color: #3498db;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .slot-status {
            font-size: 0.9em;
            color: #7f8c8d;
            min-height: 18px;
        }
        .slot-detail {
            font-size: 0.8em;
            margin-top: 5px;
            word-wrap: break-word;
            line-height: 1.4;
        }
        .slot-proxy, .slot-ua {
            font-weight: 500;
            color: #34495e;
        }
        .slot-ua {
            font-size: 0.7em; /* Smaller font for long UA string */
        }

        /* Status Colors */
        .slot.running { border-left-color: #f39c12; } 
        .slot.complete { border-left-color: #2ecc71; } 
        .slot.error { border-left-color: #e74c3c; } 
        .slot-title .status-indicator { font-weight: bold; margin-left: 10px; }
        .slot.running .status-indicator { color: #f39c12; }
        .slot.complete .status-indicator { color: #2ecc71; }
        .slot.error .status-indicator { color: #e74c3c; }

    </style>
</head>
<body>
    <div class="container">
        <h1>20-Slot Multi-Traffic Controller üöÄ</h1>
        
        <div class="input-area">
            <div class="form-group" style="flex-grow: 3;">
                <label for="mainUrl">üåê Website URL:</label>
                <input type="url" id="mainUrl" placeholder="https://yourwebsite.com" value="https://pooreyoutuber.github.io/website-booster.html" required>
            </div>
            <div class="form-group" style="flex-grow: 1;">
                <label for="refreshDelay">‚è±Ô∏è View Duration (Sec):</label>
                <input type="number" id="refreshDelay" min="7" max="15" value="9" required>
            </div>
            <button id="submitBtn">Start 20 Slots</button>
        </div>

        <div class="status-header">
            <h3>Total Slots: <span id="completedCount">0</span> / 20 Completed</h3>
            <div class="progress-bar">
                <div id="progressBarFill" class="progress-fill" style="width: 0%;">0%</div>
            </div>
        </div>

        <div id="message" style="text-align: center; margin-bottom: 15px; color: #e74c3c; font-weight: bold;"></div>
        <div id="rate-limit-info" style="text-align: center; margin-bottom: 15px; color: #2980b9; font-size: 0.9em;">**Note:** All 20 slots run simultaneously. Failure means Proxy is likely dead.</div>


        <div id="slots-container">
            </div>

    </div>

    <script>
        // ‚≠ê API URL HARDCODED HERE (YOUR RENDER URL) ‚≠ê
        // REPLACE THIS WITH YOUR ACTUAL RENDER URL
        const API_URL_BASE = "https://pooreyoutuber-github-io.onrender.com"; 
        const API_ENDPOINT = '/run-slot'; 
        const TOTAL_SLOTS = 20;

        const DOM = {
            mainUrl: document.getElementById('mainUrl'),
            refreshDelay: document.getElementById('refreshDelay'),
            submitBtn: document.getElementById('submitBtn'),
            slotsContainer: document.getElementById('slots-container'),
            completedCount: document.getElementById('completedCount'),
            progressBarFill: document.getElementById('progressBarFill'),
            message: document.getElementById('message')
        };

        const state = {
            runningSlots: 0,
            completedSlots: 0,
            totalAttempted: 0
        };
        
        // --- 1. UI Initialization ---
        function generateSlotsUI() {
            DOM.slotsContainer.innerHTML = '';
            for (let i = 1; i <= TOTAL_SLOTS; i++) {
                const slot = document.createElement('div');
                slot.id = `slot-${i}`;
                slot.className = 'slot';
                slot.innerHTML = `
                    <div class="slot-title">Slot #${i}: <span class="status-indicator">READY</span></div>
                    <div class="slot-status">Waiting for command...</div>
                    <div class="slot-detail">Proxy: <span class="slot-proxy">N/A</span></div>
                    <div class="slot-detail">UA (Gemini): <span class="slot-ua">N/A</span></div>
                `;
                DOM.slotsContainer.appendChild(slot);
            }
        }
        
        function updateProgressBar() {
            const percentage = (state.completedSlots / TOTAL_SLOTS) * 100;
            DOM.completedCount.textContent = state.totalAttempted;
            DOM.progressBarFill.style.width = `${percentage}%`;
            DOM.progressBarFill.textContent = `${Math.round(percentage)}%`;
        }

        // --- 2. Slot Execution Function (Runs Simultaneously) ---
        async function runSingleSlot(slotId, url, durationMs) {
            const slotElement = document.getElementById(`slot-${slotId}`);
            const titleElement = slotElement.querySelector('.slot-title');
            const statusElement = slotElement.querySelector('.slot-status');
            const proxyElement = slotElement.querySelector('.slot-proxy');
            const uaElement = slotElement.querySelector('.slot-ua');

            slotElement.className = 'slot running';
            titleElement.querySelector('.status-indicator').textContent = 'LAUNCHING...';
            statusElement.textContent = 'Contacting backend (Proxy/UA generation)...';
            
            state.runningSlots++;

            try {
                const response = await fetch(API_URL_BASE + API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: url,
                        duration: durationMs 
                    })
                });

                const data = await response.json();
                state.totalAttempted++;

                // Update details even if there's an error (to show proxy/UA used)
                proxyElement.textContent = data.proxy || 'N/A';
                uaElement.textContent = data.userAgent || 'N/A';
                
                if (response.ok && data.status === 'success') {
                    slotElement.className = 'slot complete';
                    titleElement.querySelector('.status-indicator').textContent = 'SUCCESS ‚úÖ';
                    statusElement.textContent = `Load complete (${(durationMs / 1000)}s view).`;
                    state.completedSlots++;
                } else {
                    throw new Error(data.message || 'Server error occurred.');
                }
            } catch (error) {
                slotElement.className = 'slot error';
                titleElement.querySelector('.status-indicator').textContent = 'FAILED ‚ùå';
                statusElement.textContent = `Error: ${error.message.substring(0, 50)}...`;
            } finally {
                state.runningSlots--;
                updateProgressBar();

                // If all 20 slots have been attempted, re-enable button
                if (state.totalAttempted === TOTAL_SLOTS) {
                    DOM.submitBtn.disabled = false;
                    DOM.submitBtn.textContent = 'Start 20 Slots (Restart)';
                    DOM.message.textContent = `Process Finished: ${state.completedSlots} successful loads out of ${TOTAL_SLOTS} attempted.`;
                }
            }
        }

        // --- 3. Main Handler ---
        function handleSubmit() {
            const mainUrl = DOM.mainUrl.value.trim();
            const refreshDelay = parseInt(DOM.refreshDelay.value); // Seconds
            const durationMs = refreshDelay * 1000;

            if (!mainUrl || !mainUrl.startsWith('http')) {
                DOM.message.textContent = "‚ùå Please enter a valid website URL (starts with http/https).";
                return;
            }
            if (refreshDelay < 7 || refreshDelay > 15) {
                DOM.message.textContent = "‚ùå View Duration must be between 7 and 15 seconds.";
                return;
            }
            
            // Reset State and UI
            state.completedSlots = 0;
            state.runningSlots = 0;
            state.totalAttempted = 0;
            updateProgressBar();
            DOM.message.textContent = '';
            DOM.submitBtn.disabled = true;
            DOM.submitBtn.textContent = 'Running 20 Slots...';
            
            // Re-initialize UI slots to 'READY'
            generateSlotsUI();
            
            // Run all 20 slots SIMULTANEOUSLY
            for (let i = 1; i <= TOTAL_SLOTS; i++) {
                runSingleSlot(i, mainUrl, durationMs);
            }
        }

        // --- Initialization ---
        DOM.submitBtn.addEventListener('click', handleSubmit);
        generateSlotsUI();
        updateProgressBar();
    </script>
</body>
</html>
