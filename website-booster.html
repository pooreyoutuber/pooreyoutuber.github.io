<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic Multi-Page Booster</title>
    <style>
        /* (Styles are mostly copied from your previous version for consistency) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f7f9fc; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; color: #333; padding: 20px 10px; box-sizing: border-box; }
        .container { background-color: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); width: 100%; max-width: 600px; text-align: center; margin-bottom: 20px; box-sizing: border-box; }
        h2 { color: #d9534f; margin-bottom: 20px; font-size: 1.8em; border-bottom: 2px solid #d9534f; padding-bottom: 10px; }
        .tip-box { background-color: #fcebeb; color: #d9534f; padding: 15px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #f9c0c3; font-size: 0.9em; font-weight: 600; }
        label { display: block; text-align: left; margin-bottom: 5px; color: #333; font-weight: bold; font-size: 0.95em; }
        input[type="text"], input[type="number"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1em; }
        button { background-color: #5cb85c; color: white; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; font-weight: bold; transition: background-color 0.3s ease; width: 100%; margin-top: 10px; }
        button:hover { background-color: #4cae4c; }
        #message { margin-top: 25px; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 0.9em; text-align: left; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        
        /* New Styles for Multi-Page Section */
        .page-entry { display: flex; gap: 10px; margin-bottom: 10px; align-items: center;}
        .page-entry input[type="text"] { flex-grow: 3; margin-bottom: 0;}
        .page-entry input[type="number"] { width: 60px; flex-grow: 0; margin-bottom: 0;}
        .percent-label { font-weight: bold; width: 50px; text-align: right; }
        #totalPercent { font-weight: bold; color: #d9534f; }
    </style>
</head>
<body>
    <div class="container">
        <div class="tip-box">
            üî• **Realistic Tip:** Views are distributed across pages for **higher credibility**. **Total percentage must be 100!**
        </div>

        <h2>Realistic Multi-Page Booster</h2>
        
        <form id="boosterForm">
            
            <label for="gaid">1. Google Analytics ID (G-XXXXX):</label>
            <input type="text" id="gaid" placeholder="e.g., G-A1B2C3D4E5" required autocomplete="off">
            
            <label for="apikey">2. API Secret (Measurement Protocol):</label>
            <input type="text" id="apikey" placeholder="Paste your generated API Secret" required autocomplete="off">
            
            <label for="views">3. Total Views to Generate (Max 500):</label>
            <input type="number" id="views" value="100" min="1" max="500" required autocomplete="off">
            
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <label style="margin-bottom: 15px;">4. View Distribution Plan (Total % must be 100):</label>

            <div class="page-entry">
                <input type="text" id="url1" class="page-url" placeholder="Page 1 URL (e.g., https://site.com)" required autocomplete="off">
                <input type="number" id="percent1" class="page-percent" value="40" min="1" max="100" required>
                <span class="percent-label">%</span>
            </div>

            <div class="page-entry">
                <input type="text" id="url2" class="page-url" placeholder="Page 2 URL (e.g., https://site.com/tool)" required autocomplete="off">
                <input type="number" id="percent2" class="page-percent" value="30" min="1" max="100" required>
                <span class="percent-label">%</span>
            </div>

            <div class="page-entry">
                <input type="text" id="url3" class="page-url" placeholder="Page 3 URL (e.g., https://site.com/about)" required autocomplete="off">
                <input type="number" id="percent3" class="page-percent" value="30" min="1" max="100" required>
                <span class="percent-label">%</span>
            </div>
            
            <p style="text-align: right; margin-top: 5px;">
                Total Percentage: <span id="totalPercent">100</span>%
            </p>
            
            <button type="submit" id="submitBtn">Start Realistic Traffic</button>
        </form>
        
        <div id="message"></div>
    </div>
    
    <script>
        // üö® IMPORTANT: ‡§á‡§∏ URL ‡§ï‡•ã ‡§Ö‡§™‡§®‡•á Render Service ‡§ï‡•á URL ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç
        const RENDER_API_URL = 'https://pooreyoutuber-github-io.onrender.com/boost-mp'; 
        const STORAGE_KEY = 'booster_details_v2'; // New key for multi-page storage
        
        const form = document.getElementById('boosterForm');
        const messageDiv = document.getElementById('message');
        const submitBtn = document.getElementById('submitBtn');
        const percentInputs = document.querySelectorAll('.page-percent');
        const totalPercentSpan = document.getElementById('totalPercent');

        // --- Local Storage Functions ---
        function loadSavedDetails() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    document.getElementById('gaid').value = data.gaid || '';
                    document.getElementById('apikey').value = data.apikey || '';
                    document.getElementById('views').value = data.views || '100';
                    document.getElementById('url1').value = data.urls[0].url || '';
                    document.getElementById('percent1').value = data.urls[0].percent || '40';
                    document.getElementById('url2').value = data.urls[1].url || '';
                    document.getElementById('percent2').value = data.urls[1].percent || '30';
                    document.getElementById('url3').value = data.urls[2].url || '';
                    document.getElementById('percent3').value = data.urls[2].percent || '30';
                } catch (e) { console.error("Error loading localStorage data:", e); }
            }
        }

        function saveDetails(gaid, apikey, views, pages) {
            const data = { gaid, apikey, views, urls: pages };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }
        
        // --- UI Functions ---
        function updateDisplayTotal() {
            let total = 0;
            percentInputs.forEach(input => {
                total += parseInt(input.value) || 0;
            });
            totalPercentSpan.textContent = total;
            totalPercentSpan.style.color = total === 100 ? '#5cb85c' : '#d9534f';
            return total;
        }

        percentInputs.forEach(input => {
            input.addEventListener('input', updateDisplayTotal);
        });

        // --- Main Submission Logic ---

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const gaId = document.getElementById('gaid').value.trim();
            const apiKey = document.getElementById('apikey').value.trim();
            let viewsCount = parseInt(document.getElementById('views').value);
            
            const totalPercent = updateDisplayTotal();
            if (totalPercent !== 100) {
                showMessage('error', `‚ùå Error: Total percentage must be 100%, but it is ${totalPercent}%.`, true);
                return;
            }

            // Collect page distribution data
            const pages = [
                { url: document.getElementById('url1').value.trim(), percent: parseInt(document.getElementById('percent1').value) },
                { url: document.getElementById('url2').value.trim(), percent: parseInt(document.getElementById('percent2').value) },
                { url: document.getElementById('url3').value.trim(), percent: parseInt(document.getElementById('percent3').value) },
            ].filter(p => p.url && p.percent > 0); // Only send valid, non-zero entries

            if (pages.length === 0) {
                 showMessage('error', '‚ùå Error: Please enter at least one valid URL.', true);
                 return;
            }

            // Save details
            saveDetails(gaId, apiKey, viewsCount, pages); 

            // Payload keys must match index.js: ga_id, api_key, views, pages
            const payload = { ga_id: gaId, api_key: apiKey, views: viewsCount, pages: pages };
            
            // Start the submission process with 2 retries (3 total attempts)
            submitData(payload, 2);
        });

        async function submitData(data, retriesLeft) {
            submitBtn.disabled = true;
            
            if (retriesLeft < 2) {
                submitBtn.textContent = `‚ö†Ô∏è Server is waking up. Retrying in 5 seconds...`;
                showMessage('info', `‚ö†Ô∏è Render is waking up. Retrying in 5 seconds...`, false);
                await new Promise(resolve => setTimeout(resolve, 5000));
            } else {
                submitBtn.textContent = '‚úÖ Request initiated. Checking server status...';
                showMessage('info', '‚úÖ Request initiated. Checking server status...', false);
            }
            
            try {
                const response = await fetch(RENDER_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }
                
                const responseData = await response.json();

                if (responseData.status === 'processing' || responseData.status === 'ok') {
                    // Success! The server accepted the job and is running in the background.
                    showMessage('success', `‚ú® Success! API accepted the request for ${data.views} views. You can close this browser now.`, true);
                } else {
                    showMessage('error', `‚ùå API Error: ${responseData.message || 'Unknown error. Check Render Logs.'}`, true);
                }

            } catch (error) {
                // Connection Error (Fetch failed) - Handles Render being asleep OR a server crash
                if (retriesLeft > 0) {
                    // Retry immediately by calling itself recursively
                    return submitData(data, retriesLeft - 1);
                } else {
                    showMessage('error', `‚ùå Final Connection Error: Server did not respond after 3 attempts. Please ensure Render service is running.`, true);
                }
            } 
            
            // Re-enable the button only after success or final failure
            submitBtn.disabled = false;
            submitBtn.textContent = 'Start Realistic Traffic';
        }

        // Load details when the page loads
        document.addEventListener('DOMContentLoaded', () => {
             loadSavedDetails();
             updateDisplayTotal(); // Initialize the total percentage display
        });
    </script>
</body>
</html>

            
