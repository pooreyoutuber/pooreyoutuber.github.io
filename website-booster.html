<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Quality Traffic Booster (Simple UI)</title>
    <style>
        /* Base Styling - Modern and Clean */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f0f4f8; 
            color: #2c3e50; 
            margin: 0; 
            padding: 20px; 
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; /* Reduced max-width for cleaner look */
            margin: 0 auto;
            background: #ffffff; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); 
        }
        h1 { 
            text-align: center; 
            color: #3498db; 
            margin-bottom: 25px; 
            font-size: 2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        /* Input Area */
        .input-area {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        .form-group {
            flex-grow: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #34495e;
        }
        input[type="url"], input[type="number"] { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #bdc3c7; 
            border-radius: 6px; 
            box-sizing: border-box; 
            font-size: 1em;
        }
        #submitBtn { 
            padding: 10px 20px; 
            background-color: #2ecc71; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-size: 1em; 
            cursor: pointer; 
            transition: background-color 0.3s; 
            flex-shrink: 0; 
            height: 40px; /* Align with input fields */
        }
        #submitBtn:hover:not(:disabled) { background-color: #27ae60; }
        #submitBtn:disabled { background-color: #95a5a6; cursor: not-allowed; }

        /* Status & Progress */
        .status-box {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #bdc3c7;
        }
        .status-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .status-text {
            font-size: 1.1em;
            font-weight: 600;
            color: #34495e;
        }
        .progress-bar {
            background-color: #dce1e7;
            border-radius: 5px;
            overflow: hidden;
            height: 20px;
        }
        .progress-fill {
            height: 100%;
            background-color: #3498db;
            transition: width 0.4s;
            text-align: center;
            color: white;
            font-size: 0.9em;
            line-height: 20px;
            font-weight: bold;
        }

        /* Slots Grid (Minimalist) */
        #slots-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 columns of slots */
            gap: 10px;
        }
        .slot {
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9em;
            font-weight: 500;
            background-color: #dce1e7;
            color: #7f8c8d;
            border: 1px solid #bdc3c7;
        }

        /* Status Colors for Slots */
        .slot.running { background-color: #f1c40f; color: #fff; border-color: #f39c12; } 
        .slot.complete { background-color: #2ecc71; color: #fff; border-color: #27ae60; } 
        .slot.error { background-color: #e74c3c; color: #fff; border-color: #c0392b; } 

    </style>
</head>
<body>
    <div class="container">
        <h1>High-Quality Traffic Booster ‚ú®</h1>
        
        <div class="input-area">
            <div class="form-group" style="flex-grow: 3;">
                <label for="mainUrl">üåê Website URL:</label>
                <input type="url" id="mainUrl" placeholder="https://yourwebsite.com" required>
            </div>
            <div class="form-group" style="flex-grow: 1;">
                <label for="refreshDelay">‚è±Ô∏è View Duration (Sec):</label>
                <input type="number" id="refreshDelay" min="7" max="15" value="9" required>
            </div>
            <button id="submitBtn">Start 20 Slots</button>
        </div>

        <div class="status-box">
            <div class="status-line">
                <span class="status-text">Total Loads Attempted: <span id="completedCount">0</span> / 20</span>
                <span class="status-text" id="statusMessage">Ready to start.</span>
            </div>
            <div class="progress-bar">
                <div id="progressBarFill" class="progress-fill" style="width: 0%;">0%</div>
            </div>
        </div>

        <div id="message" style="text-align: center; margin-bottom: 15px; color: #e74c3c; font-weight: bold;"></div>

        <div id="slots-container">
            </div>

    </div>

    <script>
        // ‚≠ê API URL HARDCODED HERE (YOUR RENDER URL) ‚≠ê
        const API_URL_BASE = "https://pooreyoutuber-github-io.onrender.com"; // CHANGE THIS
        const API_ENDPOINT = '/run-slot'; 
        const TOTAL_SLOTS = 20;

        const DOM = {
            mainUrl: document.getElementById('mainUrl'),
            refreshDelay: document.getElementById('refreshDelay'),
            submitBtn: document.getElementById('submitBtn'),
            slotsContainer: document.getElementById('slots-container'),
            completedCount: document.getElementById('completedCount'),
            progressBarFill: document.getElementById('progressBarFill'),
            message: document.getElementById('message'),
            statusMessage: document.getElementById('statusMessage')
        };

        const state = {
            completedSlots: 0, // Successful loads
            totalAttempted: 0, // Total attempts (Success + Error)
        };
        
        // --- 1. UI Initialization ---
        function generateSlotsUI() {
            DOM.slotsContainer.innerHTML = '';
            for (let i = 1; i <= TOTAL_SLOTS; i++) {
                const slot = document.createElement('div');
                slot.id = `slot-${i}`;
                slot.className = 'slot';
                slot.textContent = `#${i}: Ready`;
                DOM.slotsContainer.appendChild(slot);
            }
        }
        
        function updateStatusUI(statusText) {
            DOM.completedCount.textContent = state.totalAttempted;
            const percentage = (state.totalAttempted / TOTAL_SLOTS) * 100;
            DOM.progressBarFill.style.width = `${percentage}%`;
            DOM.progressBarFill.textContent = `${Math.round(percentage)}%`;
            DOM.statusMessage.textContent = statusText;
        }

        // --- 2. Slot Execution Function ---
        async function runSingleSlot(slotId, url, durationMs) {
            const slotElement = document.getElementById(`slot-${slotId}`);

            slotElement.className = 'slot running';
            slotElement.textContent = `#${slotId}: Running...`;
            
            try {
                const response = await fetch(API_URL_BASE + API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: url,
                        duration: durationMs 
                    }),
                    signal: AbortSignal.timeout(90000) // 90 seconds timeout for request
                });

                state.totalAttempted++;

                const data = await response.json();
                
                if (response.ok && data.status === 'success') {
                    slotElement.className = 'slot complete';
                    slotElement.textContent = `#${slotId}: SUCCESS ‚úÖ`;
                    state.completedSlots++;
                } else {
                    // Log details to console for troubleshooting, but keep UI clean
                    console.error(`Slot #${slotId} Backend Error: ${data.message || 'Unknown server error.'}. Proxy: ${data.proxy || 'N/A'}. UA: ${data.userAgent || 'N/A'}`);
                    throw new Error(data.message || 'Load failed.');
                }
            } catch (error) {
                // If the request fails (Network/Timeout) or backend returns error
                slotElement.className = 'slot error';
                slotElement.textContent = `#${slotId}: FAILED ‚ùå`;
            } finally {
                // Check if all slots have finished (regardless of success/failure)
                updateStatusUI(`Running: ${state.totalAttempted} / 20 attempts`);

                if (state.totalAttempted === TOTAL_SLOTS) {
                    DOM.submitBtn.disabled = false;
                    DOM.submitBtn.textContent = 'Start 20 Slots (Restart)';
                    DOM.message.textContent = `Process Finished: ${state.completedSlots} successful loads out of ${TOTAL_SLOTS} attempted.`;
                    updateStatusUI(`Finished. Success: ${state.completedSlots}`);
                }
            }
        }

        // --- 3. Main Handler ---
        function handleSubmit() {
            const mainUrl = DOM.mainUrl.value.trim();
            const refreshDelay = parseInt(DOM.refreshDelay.value); 
            const durationMs = refreshDelay * 1000;

            if (!mainUrl || !mainUrl.startsWith('http')) {
                DOM.message.textContent = "‚ùå Please enter a valid website URL (starts with http/https).";
                return;
            }
            if (refreshDelay < 7 || refreshDelay > 15) {
                DOM.message.textContent = "‚ùå View Duration must be between 7 and 15 seconds.";
                return;
            }
            
            // Reset State and UI
            state.completedSlots = 0;
            state.totalAttempted = 0;
            updateStatusUI('Starting all 20 slots...');
            DOM.message.textContent = '';
            DOM.submitBtn.disabled = true;
            DOM.submitBtn.textContent = 'Running 20 Slots...';
            
            generateSlotsUI();
            
            // Run all 20 slots SIMULTANEOUSLY
            for (let i = 1; i <= TOTAL_SLOTS; i++) {
                // A small delay between each call can help prevent immediate resource saturation errors (like ETXTBSY)
                setTimeout(() => {
                    runSingleSlot(i, mainUrl, durationMs);
                }, i * 50); // 50ms interval between starting calls
            }
        }

        // --- Initialization ---
        DOM.submitBtn.addEventListener('click', handleSubmit);
        generateSlotsUI();
        updateStatusUI('Ready to start.');
    </script>
</body>
</html>
