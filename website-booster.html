<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server-Side Website Booster (2-Slot Proxy)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #007bff; 
            --success-color: #28a745;
            --danger-color: #dc3545;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #343a30;
            --border-color: #ced4da;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 30px; }
        .container { max-width: 600px; margin: 0 auto; background: var(--card-bg); padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: var(--primary-color); text-align: center; margin-bottom: 25px; font-size: 26px; }

        .form-area { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 4px; background-color: #f1f1f1; }
        
        #targetUrl { padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 16px; box-sizing: border-box; }
        
        .button-group { display: flex; gap: 10px; }
        #startBtn, #stopBtn { flex: 1; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; transition: background-color 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        #startBtn { background-color: var(--success-color); color: white; }
        #stopBtn { background-color: var(--danger-color); color: white; }
        #startBtn:disabled, #stopBtn:disabled { opacity: 0.6; cursor: not-allowed; }

        #apiStatus { padding: 10px; margin-bottom: 20px; border-radius: 4px; font-weight: 500; text-align: center; background-color: #e9ecef; color: var(--text-color); }
        
        .server-status { margin-top: 20px; padding: 15px; border: 1px dashed var(--border-color); border-radius: 4px; background: #fff; }
        .server-status h2 { font-size: 18px; margin-bottom: 10px; color: var(--primary-color); }
        
        #server-log { white-space: pre-wrap; font-family: monospace; font-size: 12px; min-height: 250px; background: #f8f8f8; padding: 10px; border-radius: 4px; overflow-y: auto; }
        .slot-display { text-align: center; margin-top: 10px; color: #6c757d; font-size: 0.9em; }

    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Server-Side Website Booster (2 Slots)</h1>
        
        <div id="apiStatus">
            <i class="fas fa-spinner fa-spin"></i> Connecting to API server for config...
        </div>
        
        <div class="form-area">
            <input type="url" id="targetUrl" placeholder="Enter Target Website URL (e.g., https://example.com)" required>
            
            <div class="button-group">
                <button id="startBtn" disabled>
                    <i class="fas fa-play"></i> START TRAFFIC (2 Slots)
                </button>
                <button id="stopBtn" disabled>
                    <i class="fas fa-stop"></i> STOP ALL
                </button>
            </div>
            <div class="slot-display">
                *Traffic will be generated on the server using **2 simultaneous browser slots** with rotating proxies.
            </div>
        </div>

        <div class="server-status">
            <h2>Server Activity Log:</h2>
            <pre id="server-log">Waiting for START command...</pre>
        </div>
        
        <p style="text-align: center; margin-top: 15px; font-size: 0.8em; color: var(--danger-color);">
            *Proxies are **hardcoded** in the server code.
        </p>
    </div>

    <script>
        // *** Apni Render service ka URL yahaan dalna na bhoolen ***
        // Example: https://pooreyoutuber-github-io.onrender.com/api/booster
        const API_BASE_URL = "https://pooreyoutuber-github-io.onrender.com"; 
        
        const statusElement = document.getElementById('apiStatus');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const serverLog = document.getElementById('server-log');
        let isRunning = false;

        // --- Utility Functions ---
        function updateStatus(message, type) {
            statusElement.innerHTML = message;
            statusElement.style.backgroundColor = type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : type === 'loading' ? '#fff3cd' : '#e9ecef';
            statusElement.style.color = type === 'success' ? '#155724' : type === 'error' ? '#721c24' : type === 'loading' ? '#856404' : '#343a40';
        }

        function appendLog(message, isError = false) {
            const now = new Date().toLocaleTimeString();
            serverLog.innerHTML += `<span style="color: ${isError ? 'red' : 'green'}; font-weight: bold;">[${now}]</span> ${message}\n`;
            serverLog.scrollTop = serverLog.scrollHeight; 
        }

        // --- API Calls ---
        async function fetchConfig() {
            updateStatus(`<i class="fas fa-spinner fa-spin"></i> Connecting to API server for config...`, 'loading');
            try {
                const response = await fetch(`${API_BASE_URL}/config`);
                
                if (response.status === 503) throw new Error("Server is sleeping. Wait 15s and refresh.");
                
                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    const ua = data.config.userAgent.substring(0, 30);
                    updateStatus(`‚úÖ Config Loaded. Server UA: ${ua}... (Proxies: ${data.proxyCount})`, 'success');
                    startBtn.disabled = false;
                } else {
                    throw new Error(data.message || 'Failed to load configuration.');
                }
            } catch (error) {
                updateStatus(`‚ùå Network Error: ${error.message}`, 'error');
            }
        }
        
        async function handleStart() {
            const url = document.getElementById('targetUrl').value.trim();

            if (!url) { alert("Please enter the Target Website URL."); return; }
            if (!url.startsWith('http')) { alert("URL must start with http:// or https://"); return; }


            isRunning = true;
            startBtn.disabled = true;
            stopBtn.disabled = false;
            updateStatus(`<i class="fas fa-rocket fa-spin"></i> Sending START command to Server...`, 'loading');
            appendLog(`Command sent: Starting traffic to ${url} using hardcoded proxies.`);

            try {
                const response = await fetch(`${API_BASE_URL}/start-traffic`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url }) 
                });

                const result = await response.json();

                if (response.ok && result.status === 'success') {
                    updateStatus(`‚úÖ Traffic Started Successfully! Check server log below.`, 'success');
                    appendLog(`Server started ${result.slotCount} traffic slots successfully!`, false);
                    appendLog(`Server Message: ${result.message}`);
                } else {
                    throw new Error(result.message || 'Server failed to start traffic.');
                }
            } catch (error) {
                updateStatus(`‚ùå Start Error: ${error.message.substring(0, 70)}...`, 'error');
                appendLog(`Error: ${error.message}`, true);
                isRunning = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        async function handleStop() {
            isRunning = false;
            startBtn.disabled = true;
            stopBtn.disabled = true;
            updateStatus(`<i class="fas fa-hourglass-half"></i> Sending STOP command...`, 'loading');
            appendLog(`Command sent: Stopping all server slots.`);

            try {
                const response = await fetch(`${API_BASE_URL}/stop-traffic`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();

                if (response.ok && result.status === 'success') {
                    updateStatus(`‚è∏Ô∏è Traffic Stopped. Server is idle.`, 'success');
                    appendLog(`Server stopped all slots. Slots remaining: ${result.slotsRemaining}`, false);
                } else {
                    throw new Error(result.message || 'Server failed to stop traffic.');
                }
            } catch (error) {
                updateStatus(`‚ùå Stop Error: ${error.message.substring(0, 70)}...`, 'error');
                appendLog(`Error stopping: ${error.message}`, true);
            } finally {
                 startBtn.disabled = false;
            }
        }
        
        // --- Event Listeners and Init ---
        startBtn.addEventListener('click', handleStart);
        stopBtn.addEventListener('click', handleStop);
        document.addEventListener('DOMContentLoaded', fetchConfig);
    </script>
</body>
</html>
