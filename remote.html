<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cloud Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .search-shadow { box-shadow: 0 1px 6px rgba(32,33,36,0.28); }
        #liveView { width: 100%; border-radius: 8px; cursor: crosshair; }
    </style>
</head>
<body class="bg-white flex flex-col items-center pt-20">

    <h1 class="text-6xl font-bold mb-8">
        <span class="text-blue-500">C</span><span class="text-red-500">l</span><span class="text-yellow-500">o</span><span class="text-blue-500">u</span><span class="text-green-500">d</span><span class="text-red-500">i</span>
    </h1>

    <div class="w-full max-w-2xl px-4">
        <div class="flex items-center border rounded-full px-5 py-3 search-shadow focus-within:shadow-md">
            <i class="fas fa-search text-gray-400 mr-3"></i>
            <input type="text" id="query" class="flex-1 outline-none text-lg" placeholder="Search or type URL">
            <button onclick="startSession()" class="text-blue-500 font-bold">Launch</button>
        </div>
    </div>

    <div class="mt-10 w-full max-w-5xl p-4">
        <div id="sessionStatus" class="text-xs text-gray-400 mb-2">Ready...</div>
        <img id="liveView" src="" class="hidden border shadow-2xl">
    </div>

    <script>
        let currentSession = new URLSearchParams(window.location.search).get('s') || null;

        // Agar URL mein pehle se Session ID hai, toh dost wahi session dekhega
        if(currentSession) {
            document.getElementById('liveView').classList.remove('hidden');
            startSync();
        }

        async function startSession() {
            const url = document.getElementById('query').value;
            // Agar session nahi hai, toh backend se naya ID generate karein
            if(!currentSession) {
                currentSession = Math.random().toString(36).substring(7);
                // Update URL to share with friend
                window.history.pushState({}, '', `?s=${currentSession}`);
            }
            
            // Backend ko bolo site kholne
            await fetch('/api/action', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ sessionId: currentSession, action: 'navigate', data: { url } })
            });

            document.getElementById('liveView').classList.remove('hidden');
            startSync();
        }

        function startSync() {
            setInterval(() => {
                document.getElementById('liveView').src = `/live-check/${currentSession}?t=${Date.now()}`;
                document.getElementById('sessionStatus').innerText = `Live Session ID: ${currentSession} (Sharable)`;
            }, 2000);
        }

        // Click interaction logic...
        document.getElementById('liveView').onclick = (e) => {
            // (Same coordinates logic as before)
        };
    </script>
</body>
</html>
