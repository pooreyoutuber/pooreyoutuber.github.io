<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Browser Sync v1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0b0f1a; color: #e2e8f0; }
        .browser-frame { border: 8px solid #1e293b; border-radius: 15px; background: #000; position: relative; }
        #screen { width: 100%; cursor: crosshair; }
        .btn-green { background: #10b981; transition: 0.3s; }
        .btn-green:hover { background: #059669; transform: scale(1.05); }
    </style>
</head>
<body class="p-4">
    <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 bg-slate-800 p-4 rounded-xl">
            <input type="text" id="urlInput" placeholder="Enter URL (ex: google.com)" class="col-span-2 bg-slate-900 p-2 rounded border border-slate-700 outline-none">
            <button onclick="launch()" class="bg-blue-600 p-2 rounded font-bold">Launch</button>
            <button onclick="saveToDrive()" class="btn-green p-2 rounded font-bold">ðŸ’¾ Save to Drive</button>
        </div>

        <div class="mb-4 flex gap-2">
            <input type="text" id="keyboardInput" placeholder="Type here and press Enter" class="flex-grow bg-slate-900 p-2 rounded border border-slate-700">
            <button onclick="sendKey()" class="bg-orange-500 px-4 py-2 rounded font-bold">Send Text</button>
        </div>

        <div class="browser-frame overflow-hidden">
            <div id="loader" class="absolute inset-0 flex items-center justify-center bg-black/70 hidden z-10">
                <p class="text-white animate-pulse">Processing Action...</p>
            </div>
            <img id="screen" src="https://via.placeholder.com/1280x720?text=Press+Launch+to+Load+Session" onclick="handleClick(event)">
        </div>
    </div>

    <script>
        const API = '/cloud';
        const screen = document.getElementById('screen');
        const loader = document.getElementById('loader');

        async function launch() {
            const url = document.getElementById('urlInput').value;
            updateStatus('Starting & Loading Session...');
            await request({ action: 'launch', url });
        }

        async function saveToDrive() {
            updateStatus('Zipping & Uploading to Google Drive...');
            const data = await request({ action: 'save' });
            alert(data.message);
        }

        async function handleClick(e) {
            const rect = screen.getBoundingClientRect();
            const x = Math.round((e.clientX - rect.left) * (screen.naturalWidth / rect.width));
            const y = Math.round((e.clientY - rect.top) * (screen.naturalHeight / rect.height));
            await request({ action: 'click', x, y });
        }

        async function sendKey() {
            const text = document.getElementById('keyboardInput').value;
            await request({ action: 'type', text });
            document.getElementById('keyboardInput').value = '';
        }

        async function request(body) {
            loader.classList.remove('hidden');
            const res = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });
            const data = await res.json();
            if(data.screen) screen.src = "data:image/png;base64," + data.screen;
            loader.classList.add('hidden');
            return data;
        }

        function updateStatus(msg) { console.log(msg); }
    </script>
</body>
</html>
