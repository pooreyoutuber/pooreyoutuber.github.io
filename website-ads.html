<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Lead Mining Dashboard</title>
    
    <style>
        /* --- General Styling --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); /* Deep Blue Background */
            color: #ecf0f1;
            padding: 20px;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .dashboard {
            background-color: #1c2833;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 800px;
            padding: 30px;
        }

        h2 {
            color: #76ff03; /* Bright Green Accent */
            text-align: center;
            border-bottom: 2px solid #34495e;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        .mining-controls, .withdrawal-section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 10px;
            background-color: #2c3e50;
        }

        /* --- Input/Select Styling --- */
        .speed-selection label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .speed-selection select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #34495e;
            background-color: #34495e;
            color: #ecf0f1;
            margin-bottom: 20px;
            appearance: none;
        }

        /* --- Buttons --- */
        .start-btn {
            background-color: #76ff03;
            color: #1c2833;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            width: 100%;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .start-btn:hover:not(:disabled) {
            background-color: #64dd17;
        }

        .start-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        /* --- Stats Display --- */
        .mining-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-top: 20px;
        }

        .stat-box {
            background-color: #34495e;
            padding: 15px;
            border-radius: 10px;
            width: 45%;
        }

        .stat-box h4 {
            margin: 0 0 5px 0;
            color: #bdc3c7;
            font-size: 0.9em;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #f1c40f; /* Yellow for earnings */
        }
        
        /* --- Withdrawal Section --- */
        .withdrawal-section input {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 1px solid #34495e;
            background-color: #34495e;
            color: #ecf0f1;
        }

        .withdrawal-section p {
            font-size: 0.9em;
            color: #bdc3c7;
        }

        .withdraw-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            width: 100%;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .withdraw-btn:hover:not(:disabled) {
            background-color: #c0392b;
        }
        
        .withdraw-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h2>‚õèÔ∏è Gemini AI Lead Miner Dashboard</h2>

        <div class="mining-controls">
            <div class="speed-selection">
                <label for="miningSpeed">Mining Speed / Resource Allocation:</label>
                <select id="miningSpeed">
                    <option value="basic">Basic (Slow - 2 Leads/min)</option>
                    <option value="standard" selected>Standard (Medium - 5 Leads/min)</option>
                    <option value="turbo">Turbo (Fast - 10 Leads/min)</option>
                </select>
            </div>
            
            <button class="start-btn" id="startBtn">START AI MINING</button>
        </div>

        <div class="mining-stats">
            <div class="stat-box">
                <h4>MINED LEADS (TOTAL)</h4>
                <div class="stat-value" id="totalMinedLeads">0</div>
            </div>
            <div class="stat-box">
                <h4>ESTIMATED EARNINGS (USD)</h4>
                <div class="stat-value" id="currentEarnings">$0.00</div>
            </div>
        </div>
        
        <p style="text-align: center; margin-top: 25px; color: #bdc3c7;">
            * Current Lead Value: $1.00 per Qualified Lead (as determined by Gemini Analysis)
        </p>
        
        <hr style="border-color: #34495e; margin: 25px 0;">

        <div class="withdrawal-section">
            <h3>üí∏ Withdrawal Center</h3>
            
            <label for="walletAddress">Withdrawal Address (Wallet/UPI/Bank Account):</label>
            <input type="text" id="walletAddress" placeholder="Enter Wallet Address, UPI ID, or Bank Account">
            
            <p>
                Minimum Withdrawal: $5.00. (Fees: 2% Network Fee)
            </p>

            <button class="withdraw-btn" id="withdrawBtn" disabled>WITHDRAW $0.00</button>
        </div>
        
        <p style="text-align: center; font-size: 0.8em; color: #5dade2;">
            Node.js Backend Status: <span id="backendStatus">Connecting...</span>
        </p>
    </div>

    <script>
        const startBtn = document.getElementById('startBtn');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const speedSelect = document.getElementById('miningSpeed');
        const totalLeadsDisplay = document.getElementById('totalMinedLeads');
        const earningsDisplay = document.getElementById('currentEarnings');
        const walletInput = document.getElementById('walletAddress');
        const backendStatusDisplay = document.getElementById('backendStatus');

        // ************************************************
        // üö® IMPORTANT: REPLACE THIS URL WITH YOUR LIVE RENDER CLOUD NODE.JS BACKEND URL
        // Example: const BACKEND_URL = 'https://your-node-server.onrender.com';
        // ************************************************
        const BACKEND_URL = 'https://pooreyoutuber-github-io-blmp.onrender.com'; 

        let isMining = false;
        let totalMinedLeads = 0;
        const LEAD_VALUE = 1.00; // $1.00 per lead
        let miningInterval;
        
        // --- Utility Functions ---
        function updateUI() {
            const currentEarnings = (totalMinedLeads * LEAD_VALUE).toFixed(2);
            totalLeadsDisplay.textContent = Math.floor(totalMinedLeads);
            earningsDisplay.textContent = `$${currentEarnings}`;
            withdrawBtn.textContent = `WITHDRAW $${currentEarnings}`;
            
            withdrawBtn.disabled = (parseFloat(currentEarnings) < 5.00 || isMining);
        }

        function setMiningUIState(running) {
            isMining = running;
            startBtn.textContent = running ? 'MINING IN PROGRESS...' : 'START AI MINING';
            startBtn.disabled = running;
            speedSelect.disabled = running;
            updateUI();
        }

        // --- Backend Connection Test ---
        async function checkBackendStatus() {
             try {
                const response = await fetch(`${BACKEND_URL}/status`);
                if (response.ok) {
                    backendStatusDisplay.textContent = 'Online';
                    backendStatusDisplay.style.color = '#76ff03';
                } else {
                    throw new Error('Server not responding with 200.');
                }
            } catch (error) {
                backendStatusDisplay.textContent = 'Offline/Error';
                backendStatusDisplay.style.color = '#e74c3c';
            }
        }


        // --- Mining Logic ---
        async function startMining() {
            if (isMining) return;
            setMiningUIState(true);
            
            const speed = speedSelect.value;
            
            try {
                const response = await fetch(`${BACKEND_URL}/start-mining`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ speed: speed })
                });

                const result = await response.json();

                if (!response.ok || !result.success) {
                    throw new Error(result.message || 'Backend failed to start mining.');
                }
                
                // Start polling for stats update
                miningInterval = setInterval(fetchMiningStats, 5000); // Polls every 5 seconds

            } catch (error) {
                console.error("Mining start error:", error);
                alert(`Error starting mining: ${error.message}. Please check your Node.js server.`);
                setMiningUIState(false);
            }
        }

        // --- Fetch Stats Logic ---
        async function fetchMiningStats() {
             try {
                const response = await fetch(`${BACKEND_URL}/stats`);
                const data = await response.json();

                if (data && typeof data.totalLeads === 'number') {
                    totalMinedLeads = data.totalLeads;
                    updateUI();
                }

                // If the backend signals that the one-hour simulation is complete
                if (data && data.isComplete) {
                    clearInterval(miningInterval);
                    setMiningUIState(false);
                    alert("Mining session completed (1 Hour Simulation Complete!). You can now withdraw.");
                }

            } catch (error) {
                console.warn("Could not fetch stats. Check backend URL/connection.");
            }
        }

        // --- Withdrawal Logic ---
        async function handleWithdrawal() {
            if (totalMinedLeads * LEAD_VALUE < 5.00) {
                alert("Minimum withdrawal is $5.00.");
                return;
            }
            
            const amount = (totalMinedLeads * LEAD_VALUE).toFixed(2);
            const address = walletInput.value;
            
            if (address.length < 5) {
                alert("Please enter a valid Withdrawal Address (Wallet/UPI ID).");
                return;
            }

            // Temporarily disable the button to prevent double-click
            withdrawBtn.disabled = true;

            try {
                const response = await fetch(`${BACKEND_URL}/withdraw`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: amount, address: address })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    alert(`WITHDRAWAL SUCCESS! \n\nAmount: $${amount} \nTo Address: ${address}\n\nTransaction ID: ${result.txnId || 'N/A'}`);
                    
                    // Reset stats after successful simulation
                    totalMinedLeads = 0;
                    updateUI();
                } else {
                    alert(`WITHDRAWAL FAILED: ${result.message || 'Unknown error at backend.'}`);
                }

            } catch (error) {
                alert("Error communicating with backend for withdrawal.");
            } finally {
                withdrawBtn.disabled = false; // Re-enable if needed
                updateUI();
            }
        }


        // --- Event Listeners and Initialization ---
        startBtn.addEventListener('click', startMining);
        withdrawBtn.addEventListener('click', handleWithdrawal);
        
        // Initial setup and status check
        updateUI(); 
        checkBackendStatus(); 
    </script>
</body>
</html>
