<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Website Booster Prime (GA4 Live Simulator)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* ... (Existing CSS styles are kept for layout, but adjusted for iFrame) ... */
  /* --- CSS Styles --- */
  :root{
    --bg: #f6f8fb;--card: #ffffff;--muted: #6b7280; 
    --accent: #0f4f7f;--success: #059669; --border: #e5e7eb;
    --shadow: 0 8px 20px rgba(0,0,0,0.08);--radius: 12px;--gap: 16px; 
    --primary-blue: #0ea5e9;--danger: #dc2626;
  }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', system-ui; background: var(--bg); color: #111827; line-height: 1.5; }
  .wrap { max-width: 1400px; margin: 24px auto; padding: 12px; } 
  header { margin-bottom: 20px; text-align: center; }
  h1 { font-size: 30px; font-weight: 700; color: var(--accent); margin: 0; }
  .controls { 
    display: flex; gap: var(--gap); margin-bottom: 24px; 
    padding: var(--gap); background: var(--card); border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  .control-group { flex-grow: 1; display: flex; flex-direction: column; }
  label { font-weight: 600; font-size: 14px; color: var(--muted); margin-bottom: 6px; }
  input[type="text"], input[type="number"] {
    padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px;
    font-size: 16px; width: 100%; transition: border-color 0.2s;
  }
  .slot-container { 
    display: grid; gap: var(--gap); 
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); /* Adjusted width for iFrame */
  }
  .slot-card {
    background: var(--card); padding: var(--gap); border-radius: var(--radius);
    box-shadow: var(--shadow); border: 1px solid var(--border);
  }
  .slot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
  .slot-header h3 { font-size: 18px; margin: 0; }
  .status { padding: 4px 8px; border-radius: 4px; font-weight: 600; font-size: 12px; white-space: nowrap; }
  .status.ready { background: #e0f2f1; color: #0f766e; }
  .status.running { background: #fffbeb; color: #d97706; }
  .status.success { background: #d1fae5; color: var(--success); }
  .status.error { background: #fee2e2; color: var(--danger); }
  
  .slot-input-group { margin-bottom: 12px; }
  .slot-actions { display: flex; gap: 8px; margin-top: 16px; justify-content: space-between; }
  .slot-actions button {
    padding: 8px 12px; border: none; border-radius: 8px; font-weight: 600;
    cursor: pointer; transition: background-color 0.2s; flex-grow: 1;
  }
  .slot-actions .go-btn { background: var(--success); color: white; }
  .slot-actions .stop-btn { background: var(--danger); color: white; display: none; }
  
  .global-actions button { padding: 10px 16px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; flex-grow: 1; }
  #global-go-btn { background: var(--accent); color: white; }
  #global-stop-btn { background: var(--danger); color: white; }

  /* iFrame specific styles */
  .iframe-container { 
      width: 100%; height: 300px; border: 1px solid var(--border); 
      border-radius: 8px; margin-top: 10px; overflow: hidden;
      position: relative;
  }
  .iframe-container iframe {
      width: 100%; height: 100%; border: none;
  }
  .slot-name { font-weight: 700; color: var(--primary-blue); margin-bottom: 5px; font-size: 14px; }
  
  @media (max-width: 768px) {
    .controls { flex-direction: column; }
    .slot-container { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="wrap">
  <header>
    <h1>Website Booster Prime</h1>
    <p style="color:var(--muted);">GA4 Live Simulator (iFrame Proxy) | **Real-time views and engagement control**</p>
  </header>

  <div class="controls">
    <div class="control-group">
      <label for="global-url-input">Target Website URL</label>
      <input type="text" id="global-url-input" placeholder="e.g., https://yourcollegeproject.com">
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button id="global-go-btn">ðŸš€ Start All Slots</button>
        <button id="global-stop-btn" style="display: none;">ðŸ›‘ Stop All Slots</button>
      </div>
    </div>
    <div class="control-group" style="max-width: 250px;">
        <label for="num-slots-input">Number of Slots</label>
        <input type="number" id="num-slots-input" value="10" min="1" max="10">
    </div>
  </div>

  <div id="slot-container" class="slot-container">
    </div>
</div>

<script>
const slotContainer = document.getElementById('slot-container');
const numSlotsInput = document.getElementById('num-slots-input');
const globalUrlInput = document.getElementById('global-url-input');
const globalGoBtn = document.getElementById('global-go-btn');
const globalStopBtn = document.getElementById('global-stop-btn');

let currentSlots = [];
const slotNames = [
    "Laptop-User-1", "Mobile-User-2", "Tablet-User-3", "Desktop-User-4", 
    "Bot-Simulator-5", "Visitor-A-6", "Client-B-7", "Test-User-8", 
    "Premium-9", "Organic-10"
];

class Slot {
    constructor(id) {
        this.id = id;
        this.name = slotNames[id - 1] || `User-Slot-${id}`;
        this.statusElement = null;
        this.goBtn = null;
        this.stopBtn = null;
        this.iframeElement = null;
        this.render();
    }

    render() {
        const html = `
            <div class="slot-card" id="slot-${this.id}">
                <div class="slot-header">
                    <h3>Slot ${this.id}</h3>
                    <span class="status ready" id="status-${this.id}">Ready</span>
                </div>
                <div class="slot-name">${this.name}</div>
                <div class="slot-input-group">
                    <label for="ip-${this.id}">Proxy:Port:Auth (user:pass)</label>
                    <input type="text" id="proxy-input-${this.id}" placeholder="123.45.67.89:8080:user:pass">
                </div>
                
                <div class="slot-actions">
                    <button class="go-btn" id="go-btn-${this.id}">Load Website</button>
                    <button class="stop-btn" id="stop-btn-${this.id}">Reset</button>
                </div>
                
                <div class="iframe-container">
                    <iframe id="iframe-${this.id}" sandbox="allow-scripts allow-forms allow-same-origin" title="Slot ${this.id} Live View"></iframe>
                </div>
            </div>
        `;
        slotContainer.insertAdjacentHTML('beforeend', html);

        // Store references to elements
        this.statusElement = document.getElementById(`status-${this.id}`);
        this.goBtn = document.getElementById(`go-btn-${this.id}`);
        this.stopBtn = document.getElementById(`stop-btn-${this.id}`);
        this.proxyInput = document.getElementById(`proxy-input-${this.id}`);
        this.iframeElement = document.getElementById(`iframe-${this.id}`);

        // Set initial state
        this.setStatus('Ready', false);

        // Add event listeners for individual control
        this.goBtn.addEventListener('click', () => {
            const url = globalUrlInput.value.trim();
            if(!url){ 
                alert('Please enter a valid Target URL.'); 
                return; 
            }
            this.startProxy(url);
        });

        this.stopBtn.addEventListener('click', () => this.resetIframe());
    }

    setStatus(message, isRunning) {
        this.statusElement.textContent = message;
        this.statusElement.className = 'status'; 
        
        if (message.includes('Loading')) {
            this.statusElement.classList.add('running');
        } else if (message.includes('Loaded')) {
            this.statusElement.classList.add('success');
        } else if (message.includes('Error')) {
            this.statusElement.classList.add('error');
        } else {
            this.statusElement.classList.add('ready');
        }
        
        this.goBtn.style.display = isRunning ? 'none' : 'block';
        this.stopBtn.style.display = isRunning ? 'block' : 'none';
    }

    startProxy(globalUrl) {
        const proxyDetails = this.proxyInput.value.trim().split(':');
        
        if (proxyDetails.length !== 4) {
            this.setStatus('Error: Proxy format must be IP:Port:User:Pass', false);
            return;
        }

        const [ip, port, user, pass] = proxyDetails;
        const auth = `${user}:${pass}`;
        
        // **CRITICAL:** iFrame Proxy URL
        // proxy_loader.php will fetch the target URL using the proxy and send the HTML back.
        // The iframe will load this proxied content, and GA4 JS will run.
        const encodedUrl = encodeURIComponent(globalUrl);
        const encodedIp = encodeURIComponent(ip);
        const encodedPort = encodeURIComponent(port);
        const encodedAuth = encodeURIComponent(auth);
        
        // This time we use a simple UID (slot ID) for unique tracking in the iFrame
        const uniqueId = this.id; 

        const proxyIframeUrl = `proxy_loader.php?target=${encodedUrl}&ip=${encodedIp}&port=${encodedPort}&auth=${encodedAuth}&uid=${uniqueId}&iframe=true`;

        this.setStatus('Loading Website via Proxy...', true);
        this.iframeElement.src = proxyIframeUrl;

        // Add a timeout to simulate loading completion and check for errors
        this.iframeElement.onload = () => {
            this.setStatus('Loaded: Active User Session', true);
        };
        this.iframeElement.onerror = () => {
            this.setStatus('Error: Failed to Load (Proxy or Target)', false);
        };

        // Fallback for timeout simulation
        setTimeout(() => {
            if (this.statusElement.textContent.includes('Loading')) {
                 this.setStatus('Loaded: Active User Session', true);
            }
        }, 10000); // 10 second delay for visual effect
    }
    
    resetIframe() {
        this.iframeElement.src = 'about:blank';
        this.setStatus('Ready', false);
    }
}

function renderSlots(count) {
    // Limit slots to 10
    if (count > 10) count = 10;
    
    // Clear old slots and intervals
    stopAllAutomation();
    slotContainer.innerHTML = '';
    currentSlots = [];

    // Create new slots
    for (let i = 1; i <= count; i++) {
        currentSlots.push(new Slot(i));
    }
}

function stopAllAutomation() {
    globalGoBtn.style.display = 'block';
    globalStopBtn.style.display = 'none';
    
    currentSlots.forEach(s => s.resetIframe());
}

// Global Start/Run Logic
globalGoBtn.addEventListener('click', ()=> {
  const url = globalUrlInput.value.trim();
  if(!url){ 
      alert('Please enter a valid Target URL.'); 
      return; 
  }
  
  globalGoBtn.style.display = 'none';
  globalStopBtn.style.display = 'block';

  // Start all slots
  currentSlots.forEach(s => s.startProxy(url));
});

// Event listeners
numSlotsInput.addEventListener('change', (e) => {
    let count = parseInt(e.target.value);
    if (isNaN(count) || count < 1) count = 1; 
    renderSlots(count);
});

globalStopBtn.addEventListener('click', stopAllAutomation);

// Initialize with default slots (10)
renderSlots(parseInt(numSlotsInput.value));
</script>

</body>
</html>
