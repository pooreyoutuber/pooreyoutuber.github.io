<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Geo Browser Tool — Single URL</title>
  <style>
    body { font-family: Inter, system-ui, sans-serif; background:#f6f8fb; color:#111; padding:24px; }
    .card { background:#fff; padding:18px; border-radius:10px; max-width:820px; margin:0 auto; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    input[type=url], select { width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:8px; margin-top:8px; }
    button { margin-top:12px; padding:10px 14px; background:#0ea5e9; color:white; border:0; border-radius:8px; cursor:pointer; font-weight:600; }
    pre { background:#0f172a; color:#fff; padding:12px; border-radius:8px; overflow:auto; max-height:260px; white-space:pre-wrap;}
  </style>
</head>
<body>
  <div class="card">
    <h2>Geo Browser Tool</h2>
    <p>Paste target URL, choose proxy and click Open. Server will launch a browser with that proxy and open the URL.</p>

    <label>Target URL</label>
    <input id="targetUrl" type="url" placeholder="https://example.com" />

    <label style="margin-top:10px">Choose Proxy / Geo</label>
    <select id="proxySelect"></select>

    <div style="display:flex; gap:8px; margin-top:10px; align-items:center;">
      <label style="display:flex;align-items:center;gap:6px;">
        <input id="headful" type="checkbox" /> Headful (visible) browser
      </label>
      <label style="display:flex;align-items:center;gap:6px;">
        Hold (ms)
        <input id="holdMs" type="number" value="30000" style="width:120px; padding:6px; margin-left:8px;" />
      </label>
    </div>

    <button id="openBtn">Open with Selected Geo</button>

    <h4 style="margin-top:14px">Result / Logs</h4>
    <pre id="log">No action yet.</pre>
  </div>

<script>
async function loadProxies() {
  const sel = document.getElementById('proxySelect');
  sel.innerHTML = '<option>Loading...</option>';
  try {
    const r = await fetch('/api/proxies');
    const list = await r.json();
    sel.innerHTML = '';
    list.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.idx;
      opt.textContent = p.label + ' (' + p.browserType + ')';
      sel.appendChild(opt);
    });
  } catch (e) {
    sel.innerHTML = '<option>Error loading proxies</option>';
    log('Error fetching proxies: ' + e.message);
  }
}

function log(msg) {
  const el = document.getElementById('log');
  el.textContent = (new Date()).toLocaleTimeString() + '  ›  ' + msg + '\n' + el.textContent;
}

document.getElementById('openBtn').addEventListener('click', async () => {
  const url = document.getElementById('targetUrl').value.trim();
  const proxyIndex = document.getElementById('proxySelect').value;
  const headful = document.getElementById('headful').checked;
  const holdMs = document.getElementById('holdMs').value || 30000;

  if (!url) { alert('Please enter a valid URL'); return; }

  log('Sending request to open URL: ' + url);
  try {
    const res = await fetch('/api/open', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ url, proxyIndex, headful, holdMs })
    });
    const json = await res.json();
    if (!res.ok) {
      log('Server error: ' + (json.error || JSON.stringify(json)));
    } else {
      log('Launched. sessionId: ' + json.sessionId + '\nIP info: ' + JSON.stringify(json.ipInfo));
    }
  } catch (err) {
    log('Request failed: ' + err.message);
  }
});

loadProxies();
</script>
</body>
</html>
