<!doctype html>

<html lang="en">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>YouTube Channel SEO & Audit Tool â€” Dual View</title>
Â  <style>
Â  Â  /* Global Styling for Clean UI */
Â  Â  :root{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#f7fafc;color:#111}
Â  Â  body{margin:16px}
Â  Â  .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,.06);max-width:1100px; margin: 0 auto;}
Â  Â Â 
Â  Â  /* Input/Button Styling */
Â  Â  label{display:block;margin:8px 0}
Â  Â  input,select,button,textarea{padding:8px;border-radius:6px;border:1px solid #ddd;font-size:14px}
Â  Â  button{cursor:pointer; background:#007bff; color:#fff; transition: background 0.2s; border: none;}
Â  Â  button:hover { background:#0056b3; }
Â  Â Â 
Â  Â  /* Data Display Styling */
Â  Â  table{width:100%;border-collapse:collapse;margin-top:12px}
Â  Â  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
Â  Â  .muted{color:#666;font-size:13px}
Â  Â  .small{font-size:13px}
Â  Â  .bad{color:#b91c1c}
Â  Â  .good{color:#065f46}
Â  Â  .kpi{display:inline-block;padding:6px 10px;border-radius:8px;margin-right:8px;background:#f1f5f9; font-weight: bold;}
Â  Â Â 
Â  Â  /* Audit Summary Grid (UI 1) */
Â  Â  .audit-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;}
Â  Â  .audit-item { padding: 10px; border: 1px solid #eee; border-radius: 6px; }
Â  Â  .status-icon { font-size: 20px; float: right; }
Â  Â  .check { color: #065f46; }
Â  Â  .cross { color: #b91c1c; }
Â  Â Â 
Â  Â  /* Overall Score Circle (UI 1) */
Â  Â  .score-circle { width: 150px; height: 150px; border-radius: 50%; border: 10px solid #eee; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; position: relative; margin: 0 auto;}
Â  Â  .score-container { text-align: center; margin: 20px auto; max-width: 300px;}
Â  Â Â 
Â  Â  /* Dual View Buttons Styling */
Â  Â  .view-buttons button { background: #eee; color: #333; border: 1px solid #ddd; margin-right: 5px; }
Â  Â  .view-buttons button.active { background: #007bff; color: #fff; border-color: #007bff; }
Â  Â Â 
Â  Â  /* Hide/Show Views */
Â  Â  .report-view { display: none; }
Â  Â  .report-view.active { display: block; }

Â  Â  /* UI 2 (KPIs/Social Blade Style) */
Â  Â  .kpi-large { font-size: 24px; font-weight: bold; color: #333; margin-top: 5px;}
Â  Â  .kpi-label { font-size: 14px; color: #666; }
Â  Â  .kpi-box { text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px;}
Â  Â  .kpi-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
Â  Â  .daily-table th, .daily-table td { font-size: 13px; padding: 6px 8px; }
Â  Â  .daily-table .change-good { color: #065f46; font-weight: bold; }
Â  Â  .daily-table .change-bad { color: #b91c1c; font-weight: bold; }

Â  </style>
</head>
<body>
Â  <h1>YouTube Channel SEO & Audit Tool</h1>
Â  <div class="card">
Â  Â Â 
Â  Â  <p class="muted">Enter a YouTube <strong>channel name</strong> or <strong>channel ID</strong>. This tool is safe.</p>
Â  Â Â 
<label>Channel name or channel ID: <input id="query" placeholder="e.g. PewDiePie or UC-lHJZR3Gqxm24_Vd_AJ5Yw" style="width:100%" /></label>

<div style="margin-top:10px; display: flex; justify-content: flex-start; gap: 10px;">
Â  <button id="searchBtn">Search & Audit</button>
Â  <button id="downloadCsv" disabled style="background:#17a2b8;">Download CSV (videos)</button>
</div>

<div id="status" class="muted" style="margin-top:10px">Ready.</div>

<hr />

<div class="view-buttons" style="margin-bottom: 20px;">
Â  Â  <button id="btnAuditView" class="active">Audit Score & Suggestions</button>
Â  Â  <button id="btnStatusView">Channel Status & Performance</button>
</div>

<div id="reportContainer">
Â  Â Â 
Â  Â  <div id="auditView" class="report-view active">
Â  Â  Â  Â  <div id="auditReportHeader">
Â  Â  Â  Â  Â  Â  <div class="score-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="scoreCircle" class="score-circle">â€”%</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="scoreMessage" style="margin-top: 10px; font-weight: bold;">Enter channel to run audit</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="recommendations" style="margin-top: 5px; color: #dc3545;">â€” Recommendations</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="muted small">Report Generated: <span id="reportDate">N/A</span></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <h2>Profile</h2>
Â  Â  Â  Â  Â  Â  <div class="audit-grid" id="profileAudit"></div>

Â  Â  Â  Â  Â  Â  <h2>Content</h2>
Â  Â  Â  Â  Â  Â  <div class="audit-grid" id="contentAudit"></div>

Â  Â  Â  Â  Â  Â  <h2>Engagement</h2>
Â  Â  Â  Â  Â  Â  <div class="audit-grid" id="engagementAudit"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <hr/>
Â  Â  Â  Â  <h3>Audit / Suggestions & Tips (Problems aur Sujaav)</h3>
Â  Â  Â  Â  <div id="audit"></div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <hr/>
Â  Â  Â  Â  <h3>Top videos (by views)</h3>
Â  Â  Â  Â  <div id="topVideos"></div>

Â  Â  Â  Â  <h3>Video list</h3>
Â  Â  Â  Â  <div id="videoTable"></div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div id="statusView" class="report-view">
Â  Â  Â  Â  <h2 id="statusTitle">Channel Status Overview</h2>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="kpi-row" id="kpiOverview">
Â  Â  Â  Â  Â  Â  <div class="kpi-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-label">Subscribers</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-large" id="statusSubscribers">â€”</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="kpi-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-label">Total Video Views</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-large" id="statusViews">â€”</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="kpi-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-label">Videos Count</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-large" id="statusVideos">â€”</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <h3>Estimated Earnings (Tips Rupees)</h3>
Â  Â  Â  Â  <p class="muted">Based on average views and typical CPM ranges (Data is placeholder/estimated for demonstration).</p>
Â  Â  Â  Â  <div class="kpi-row" style="grid-template-columns: repeat(2, 1fr);">
Â  Â  Â  Â  Â  Â  Â <div class="kpi-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-label">Monthly Est. Earnings (Low)</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-large bad" id="estMonthlyLow">â€”</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="kpi-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-label">Monthly Est. Earnings (High)</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="kpi-large good" id="estMonthlyHigh">â€”</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h3>Daily Performance (Placeholder Data)</h3>
Â  Â  Â  Â  <table class="daily-table">
Â  Â  Â  Â  Â  Â  <thead><tr><th>Date</th><th>Views</th><th>Subs Change</th><th>Est. Earnings</th></tr></thead>
Â  Â  Â  Â  Â  Â  <tbody id="dailyPerformanceTable">
Â  Â  Â  Â  Â  Â  Â  Â  <tr><td>Today</td><td id="dView">0</td><td id="dSubs" class="change-bad">0</td><td id="dEarnings">N/A</td></tr>
Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  </table>
Â  Â  Â  Â Â 
Â  Â  </div>
Â  Â Â 
</div> </div><script>

// UI Elements
const searchBtn = document.getElementById('searchBtn');
const queryEl = document.getElementById('query');
const statusEl = document.getElementById('status');
const downloadCsvBtn = document.getElementById('downloadCsv');
const auditView = document.getElementById('auditView');
const statusView = document.getElementById('statusView');
const btnAuditView = document.getElementById('btnAuditView');
const btnStatusView = document.getElementById('btnStatusView');

// *******************************************************************
// ** FIX: REPLACE THE PLACEHOLDER WITH YOUR NETLIFY URL **
// *******************************************************************
const API_BASE_URL = "https://pooreyoutuber.netlify.app"; // âœ… CORRECTION APPLIED

let lastChannelData = null; // To store data for view switching

// --- UTILITY FUNCTIONS ---
function log(s){ statusEl.textContent = s; }
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

// --- VIEW SWITCHING LOGIC ---
function switchView(viewId) {
Â  Â  const views = [auditView, statusView];
Â  Â  const buttons = [btnAuditView, btnStatusView];
Â  Â Â 
Â  Â  views.forEach(v => v.classList.remove('active'));
Â  Â  buttons.forEach(b => b.classList.remove('active'));
Â  Â Â 
Â  Â  if (viewId === 'audit') {
Â  Â  Â  Â  auditView.classList.add('active');
Â  Â  Â  Â  btnAuditView.classList.add('active');
Â  Â  } else {
Â  Â  Â  Â  statusView.classList.add('active');
Â  Â  Â  Â  btnStatusView.classList.add('active');
Â  Â  }
}

btnAuditView.addEventListener('click', () => switchView('audit'));
btnStatusView.addEventListener('click', () => switchView('status'));

// --- ANALYSIS AND RENDERING (UI 1: Audit Score/Suggestions) ---

function createAuditItem(title, value, status, detail) {
Â  Â  const icon = status === 'good' ? '&#10004;' : '&#10006;';Â 
Â  Â  const colorClass = status === 'good' ? 'good' : 'bad';
Â  Â  return `
Â  Â  Â  Â  <div class="audit-item">
Â  Â  Â  Â  Â  Â  <strong>${title}</strong>
Â  Â  Â  Â  Â  Â  <span class="status-icon ${colorClass}">${icon}</span>
Â  Â  Â  Â  Â  Â  <div class="small" style="margin-top: 5px;">${value}</div>
Â  Â  Â  Â  Â  Â  <div class="muted small">${detail}</div>
Â  Â  Â  Â  </div>
Â  Â  `;
}

function renderAuditGrid(channel, videos, analysis) {
Â  Â  const stats = channel.statistics || {};
Â  Â  const snippet = channel.snippet || {};
Â  Â Â 
Â  Â  // --- Profile ---
Â  Â  const profileHTML = [
Â  Â  Â  Â  createAuditItem("Channel Title", snippet.title || "Missing", snippet.title ? 'good' : 'bad', "Your page has description title."),
Â  Â  Â  Â  createAuditItem("Description Text", (snippet.description||'').length > 50 ? 'Long Description' : "Too Short", (snippet.description||'').length > 50 ? 'good' : 'bad', "A compelling description (200+ chars) helps SEO."),
Â  Â  Â  Â  createAuditItem("Channel Country", snippet.country || "No country", snippet.country ? 'good' : 'bad', "Setting a country helps with regional targeting."),
Â  Â  ].join('');
Â  Â  document.getElementById('profileAudit').innerHTML = profileHTML;

Â  Â  // --- Content ---
Â  Â  const contentHTML = [
Â  Â  Â  Â  createAuditItem("Number of Videos", `Videos: ${analysis.totals.videos}`, analysis.totals.videos > 50 ? 'good' : 'bad', `Good video count: ${analysis.totals.videos}`),
Â  Â  Â  Â  createAuditItem("Posting Frequency", `Avg Gap: ${analysis.avgUploadGap.toFixed(1)} days`, analysis.avgUploadGap < 30 ? 'good' : 'bad', `Consistent uploads help channel growth.`),Â 
Â  Â  Â  Â  createAuditItem("Video Completeness", `Missing Tags: ${analysis.missingTagsCount} videos`, analysis.missingTagsCount === 0 ? 'good' : 'bad', `Ensure all videos have relevant tags.`),
Â  Â  ].join('');
Â  Â  document.getElementById('contentAudit').innerHTML = contentHTML;
Â  Â Â 
Â  Â  // --- Engagement ---
Â  Â  const engagementHTML = [
Â  Â  Â  Â  createAuditItem("Channel Subscribers", `${formatNumber(stats.subscriberCount||0)}`, (stats.subscriberCount||0) > 100 ? 'good' : 'bad', "Subscribers count is a key growth metric."),
Â  Â  Â  Â  createAuditItem("Average Video Views", `${formatNumber(analysis.avgViews.toFixed(0))}`, analysis.avgViews > 500 ? 'good' : 'bad', "Average views show content reach."),
Â  Â  Â  Â  createAuditItem("Average Video Likes", `${formatNumber(analysis.avgLikes.toFixed(0))}`, analysis.avgLikes > 10 ? 'good' : 'bad', "Low likes can indicate low engagement."),
Â  Â  Â  Â  createAuditItem("Average Video Comments", `${formatNumber(analysis.avgComments.toFixed(0))}`, analysis.avgComments > 0 ? 'good' : 'bad', "Comments drive community interaction."),
Â  Â  ].join('');
Â  Â  document.getElementById('engagementAudit').innerHTML = engagementHTML;

Â  Â  // --- Score ---
Â  Â  const score = 100 - (analysis.issues.length * 10);Â 
Â  Â  document.getElementById('scoreCircle').textContent = `${Math.max(50, score)}%`;
Â  Â  document.getElementById('recommendations').textContent = `You have ${analysis.issues.length} Recommendations`;
Â  Â  document.getElementById('reportDate').textContent = new Date().toLocaleDateString('en-US', {day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit'});
Â  Â  document.getElementById('scoreMessage').textContent = score > 80 ? 'Your page is performing well!' : 'Your page could be better.';
Â  Â Â 
Â  Â  // Channel name for the header
Â  Â  document.getElementById('auditReportHeader').querySelector('h2').previousElementSibling.innerHTML = `
Â  Â  Â  Â  <strong>Channel: ${channel.snippet.title}</strong>
Â  Â  Â  Â  <div class="muted">@${channel.snippet.customUrl || 'N/A'}</div>
Â  Â  Â  Â  <div style="margin-top:8px">
Â  Â  Â  Â  Â  Â  <span class="kpi">Subscribers: ${formatNumber(channel.statistics.subscriberCount||0)}</span>
Â  Â  Â  Â  Â  Â  <span class="kpi">Total views (channel): ${formatNumber(channel.statistics.viewCount||0)}</span>
Â  Â  Â  Â  Â  Â  <span class="kpi">Videos fetched: ${videos.length}</span>
Â  Â  Â  Â  </div>
Â  Â  `;
}

function renderAudit(issues){
Â  Â  const auditEl = document.getElementById('audit');
Â  if(issues.length===0) auditEl.innerHTML = '<div class="good">No major automated issues found. Manual review recommended for thumbnails and watch-time metrics.</div>';
Â  else{
Â  Â  // Provide Sujaav/Tips
Â  Â  auditEl.innerHTML = '<ul>' + issues.map(it=>`<li><strong>${it.k} (Problem):</strong> ${it.desc} <strong>(Sujaav/Tip)</strong></li>`).join('') + '</ul>';
Â  }
}

// --- RENDERING (UI 2: Channel Status/Performance) ---

function renderStatusView(channel, videos, analysis) {
Â  Â  const stats = channel.statistics || {};
Â  Â Â 
Â  Â  document.getElementById('statusTitle').textContent = `Channel Status Overview for ${channel.snippet.title}`;
Â  Â Â 
Â  Â  // Main KPIs
Â  Â  document.getElementById('statusSubscribers').textContent = formatNumber(stats.subscriberCount||0);
Â  Â  document.getElementById('statusViews').textContent = formatNumber(stats.viewCount||0);
Â  Â  document.getElementById('statusVideos').textContent = formatNumber(videos.length);
Â  Â Â 
Â  Â  // Estimated Earnings (Dummy Calculation for demo)
Â  Â  // Assuming low CPM is $2 (â‚¹160) and high CPM is $6 (â‚¹480) per 1000 views
Â  Â  const monthlyViews = (analysis.avgViews * videos.length) / analysis.avgUploadGap * 30; // Rough monthly views
Â  Â  const estLow = (monthlyViews / 1000) * 2 * 80; // USD to INR conversion (80 approx)
Â  Â  const estHigh = (monthlyViews / 1000) * 6 * 80;
Â  Â Â 
Â  Â  document.getElementById('estMonthlyLow').textContent = `â‚¹${formatNumber(estLow.toFixed(0))} / $${formatNumber((estLow/80).toFixed(0))}`;
Â  Â  document.getElementById('estMonthlyHigh').textContent = `â‚¹${formatNumber(estHigh.toFixed(0))} / $${formatNumber((estHigh/80).toFixed(0))}`;
Â  Â Â 
Â  Â  // Daily Performance (Placeholder data to mimic screenshot)
Â  Â  const todayViews = analysis.avgViews * 0.8; // Today's views (simulated)
Â  Â  const subsChange = Math.random() > 0.5 ? Math.floor(Math.random() * 500) : -Math.floor(Math.random() * 100);
Â  Â Â 
Â  Â  document.getElementById('dView').textContent = formatNumber(todayViews.toFixed(0));
Â  Â  document.getElementById('dSubs').textContent = (subsChange > 0 ? '+' : '') + formatNumber(subsChange);
Â  Â  document.getElementById('dSubs').className = subsChange > 0 ? 'change-good' : 'change-bad';
Â  Â  document.getElementById('dEarnings').textContent = `$${((todayViews / 1000) * (2 + Math.random() * 4)).toFixed(2)}`;
Â  Â Â 
Â  Â  // Clear/Reset daily table for simplicity
Â  Â  document.getElementById('dailyPerformanceTable').innerHTML = `
Â  Â  Â  Â  <tr><td>Today</td><td id="dView">${document.getElementById('dView').textContent}</td><td id="dSubs" class="${document.getElementById('dSubs').className}">${document.getElementById('dSubs').textContent}</td><td id="dEarnings">${document.getElementById('dEarnings').textContent}</td></tr>
Â  Â  Â  Â  <tr><td>Yesterday</td><td>${formatNumber((todayViews * 1.1).toFixed(0))}</td><td class="change-good">+550</td><td>$15.20</td></tr>
Â  Â  Â  Â  <tr><td>2 days ago</td><td>${formatNumber((todayViews * 0.9).toFixed(0))}</td><td class="change-bad">-20</td><td>$12.90</td></tr>
Â  Â  `;
}


function analyzeVideos(channel, videos){
Â  // (Analysis logic remains the same)
Â  const totals = { videos: videos.length, views:0, likes:0, comments: 0 };
Â  let top = null;
Â  videos.forEach(v=>{
Â  Â  const s = v.statistics || {};
Â  Â  const viewCount = Number(s.viewCount || 0);
Â  Â  const likeCount = Number(s.likeCount || 0);
Â  Â  const commentCount = Number(s.commentCount || 0);
Â  Â Â 
Â  Â  totals.views += viewCount;
Â  Â  totals.likes += likeCount;
Â  Â  totals.comments += commentCount;
Â  Â Â 
Â  Â  if(!top || viewCount > (top.statistics?.viewCount||0)) top = v;
Â  });

Â  const issues = [];
Â  const videosCount = Math.max(1, videos.length);
Â  const avgViews = totals.views / videosCount;
Â  const avgLikes = totals.likes / videosCount;
Â  const avgComments = totals.comments / videosCount;

Â  const missingTags = videos.filter(v => !v.snippet.tags || v.snippet.tags.length===0).length;
Â  const shortDesc = videos.filter(v => (v.snippet.description||'').length < 50).length;
Â  const longTitles = videos.filter(v => (v.snippet.title||'').length > 80).length;
Â Â 
Â  if(missingTags > videos.length*0.3) issues.push({k:'Missing tags',desc:`${missingTags} of ${videos.length} videos have no tags. Tags help discovery and related video matching. **Tip:** Use 5-10 specific, relevant tags for every video.`});
Â  if(shortDesc > videos.length*0.2) issues.push({k:'Short descriptions',desc:`${shortDesc} videos have very short descriptions. **Tip:** Use 200+ characters with keywords, timestamps, and links to increase watch time.`});
Â  if(longTitles>0) issues.push({k:'Long titles',desc:`${longTitles} videos have titles longer than 80 characters. **Tip:** Keep titles concise and front-load keywords (under 60 characters is ideal).`});
Â  if(avgViews < 50) issues.push({k:'Low Average Views', desc: `Average video views are very low (${avgViews.toFixed(0)}). **Tip:** Focus on better thumbnails (CTR) and stronger content quality (Watch Time).`});
Â  if(channel.snippet.country === undefined) issues.push({k:'Missing Channel Country', desc: `Channel country is not set. **Tip:** Set your channel country for regional discoverability and better ad matching.`});

Â  const dates = videos.map(v=> new Date(v.snippet.publishedAt));
Â  dates.sort((a,b)=>a-b);
Â  let avgUploadGap = 0;
Â  if(dates.length>=2){
Â  Â  const diffs = [];
Â  Â  for(let i=1;i<dates.length;i++) diffs.push( (dates[i]-dates[i-1]) / (1000*60*60*24) );
Â  Â  avgUploadGap = diffs.reduce((a,b)=>a+b,0)/diffs.length;
Â  Â  if(avgUploadGap>30) issues.push({k:'Low upload frequency',desc:`Average upload gap is ${avgUploadGap.toFixed(1)} days. **Tip:** Target a consistent schedule, like one video every 7 or 14 days, for better algorithm support.`});
Â  }

Â  return {totals, top, issues, avgViews, avgLikes, avgComments, missingTagsCount: missingTags, avgUploadGap};
}

function renderTopVideos(videos){
Â  Â  const top = videos.slice().sort((a,b)=> (Number(b.statistics.viewCount||0) - Number(a.statistics.viewCount||0))).slice(0,10);
Â  Â  let html = '<ol style="padding-left: 20px;">' + top.map(v=>{
Â  Â  Â  Â  const tags = (v.snippet.tags || []).map(tag => `#${tag}`).join(' ');
Â  Â  Â  Â  return `<li>
Â  Â  Â  Â  Â  Â  <a target="_blank" href="https://youtu.be/${v.id}">${v.snippet.title}</a>Â 
Â  Â  Â  Â  Â  Â  <span class="muted small">${tags}</span> â€” ${formatNumber(v.statistics.viewCount||0)} views
Â  Â  Â  Â  </li>`;
Â  Â  }).join('') + '</ol>';
Â  Â  document.getElementById('topVideos').innerHTML = html;
}

function renderVideoTable(videos){
Â  const rows = videos.map(v=>{
Â  Â  const s=v.statistics||{}; const snippet=v.snippet||{};
Â  Â  return `<tr>
Â  Â  Â  <td><a target=_blank href="https://youtu.be/${v.id.videoId || v.id}">${escapeHtml(snippet.title||'')}</a></td>
Â  Â  Â  <td>${snippet.publishedAt? new Date(snippet.publishedAt).toLocaleDateString():''}</td>
Â  Â  Â  <td>${formatNumber(s.viewCount||0)}</td>
Â  Â  Â  <td>${formatNumber(s.likeCount||'â€”')}</td>
Â  Â  Â  <td>${(snippet.tags && snippet.tags.length)?snippet.tags.length:0}</td>
Â  Â  Â  <td class="small">${escapeHtml( (snippet.description||'').slice(0,100) )}${(snippet.description||'').length>100?'...':''}</td>
Â  Â  </tr>`;
Â  }).join('');
Â  document.getElementById('videoTable').innerHTML = `<table><thead><tr><th>Title</th><th>Date</th><th>Views</th><th>Likes</th><th>Tags</th><th>Description Snippet</th></tr></thead><tbody>${rows}</tbody></table>`;
}

// --- MAIN FETCH LOGIC ---
searchBtn.addEventListener('click', async () => {
Â  Â  const q = queryEl.value.trim();
Â  Â  if (!q) {
Â  Â  Â  Â  log('Please enter a channel name or ID.');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  log('Fetching channel data securely...');
Â  Â  downloadCsvBtn.disabled = true;

Â  Â  try {
Â  Â  Â  Â  // Fetch call uses the secure Netlify function endpoint
Â  Â  Â  Â  const res = await fetch(`${API_BASE_URL}/.netlify/functions/audit-data?query=` + encodeURIComponent(q));
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  let errorData;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  errorData = await res.json();
Â  Â  Â  Â  Â  Â  } catch {
Â  Â  Â  Â  Â  Â  Â  Â  // This block handles the "Failed to fetch" (CORS/Network error)
Â  Â  Â  Â  Â  Â  Â  Â  errorData = { error: `Failed to connect or server error (${res.status}). Check API_BASE_URL and CORS settings.` };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  throw new Error(JSON.stringify(errorData));
Â  Â  Â  Â  }

Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (data.error) {
Â  Â  Â  Â  Â  Â  throw new Error(data.error);
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!data.channel || !data.videos) {
Â  Â  Â  Â  Â  Â  throw new Error("Could not parse YouTube data. Channel not found or API error.");
Â  Â  Â  Â  }

Â  Â  Â  Â  lastChannelData = data;
Â  Â  Â  Â  log(`Done. Channel: ${data.channel.snippet.title}. Videos fetched: ${data.videos.length}`);
Â  Â  Â  Â  downloadCsvBtn.disabled = false;

Â  Â  Â  Â  // Process and Render Data
Â  Â  Â  Â  const analysis = analyzeVideos(data.channel, data.videos);
Â  Â  Â  Â  renderAuditGrid(data.channel, data.videos, analysis);
Â  Â  Â  Â  renderAudit(analysis.issues);
Â  Â  Â  Â  renderTopVideos(data.videos);
Â  Â  Â  Â  renderVideoTable(data.videos);
Â  Â  Â  Â  renderStatusView(data.channel, data.videos, analysis); // UI 2

Â  Â  Â  Â  switchView('audit'); // Show audit view by default
Â  Â  Â  Â Â 
Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Fetch error:", error);
Â  Â  Â  Â  let errorMessage = error.message;
Â  Â  Â  Â  // Agar error JSON format mein hai, toh use parse karke clean message dikhayein
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const parsedError = JSON.parse(error.message);
Â  Â  Â  Â  Â  Â  errorMessage = parsedError.error || "Unknown server error.";
Â  Â  Â  Â  } catch {}
Â  Â  Â  Â Â 
Â  Â  Â  Â  log(`ðŸ”´ Error: ${errorMessage}`);
Â  Â  }
});

// --- CSV Download Logic ---
downloadCsvBtn.addEventListener('click', () => {
Â  Â  if (!lastChannelData || lastChannelData.videos.length === 0) {
Â  Â  Â  Â  alert("No data available to download.");
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const header = ["Title", "Published At", "Views", "Likes", "Comment Count", "Tags", "Description"].join(',');
Â  Â  const csvRows = lastChannelData.videos.map(v => {
Â  Â  Â  Â  const snippet = v.snippet;
Â  Â  Â  Â  const stats = v.statistics || {};
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Enclose strings in quotes and escape internal quotes
Â  Â  Â  Â  const clean = (s) => `"${String(s).replace(/"/g, '""')}"`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const title = clean(snippet.title || '');
Â  Â  Â  Â  const published = snippet.publishedAt ? new Date(snippet.publishedAt).toLocaleDateString() : '';
Â  Â  Â  Â  const views = stats.viewCount || 0;
Â  Â  Â  Â  const likes = stats.likeCount || 0;
Â  Â  Â  Â  const comments = stats.commentCount || 0;
Â  Â  Â  Â  const tags = clean((snippet.tags || []).join('|')); // Use | as internal separator
Â  Â  Â  Â  const description = clean(snippet.description || '');
Â  Â  Â  Â Â 
Â  Â  Â  Â  return [title, published, views, likes, comments, tags, description].join(',');
Â  Â  });

Â  Â  const csvContent = "data:text/csv;charset=utf-8," + encodeURIComponent(header + "\n" + csvRows.join('\n'));
Â  Â Â 
Â  Â  const link = document.createElement('a');
Â  Â  link.setAttribute('href', csvContent);
Â  Â  link.setAttribute('download', `youtube_audit_data_${lastChannelData.channel.snippet.title.replace(/\s/g, '_')}.csv`);
Â  Â  document.body.appendChild(link);
Â  Â  link.click();
Â  Â  document.body.removeChild(link);
});
</script></body>
</html>
