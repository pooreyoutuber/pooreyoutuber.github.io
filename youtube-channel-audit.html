<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <title>YouTube Channel Audit — Single File</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#071025; --card:#0f1724; --muted:#9fb0c8; --accent:#ff7a59;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, Arial, sans-serif}
    body{margin:0;background:linear-gradient(180deg,#041027 0%,#071226 100%);color:#e6eef6;padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    h1{margin:6px 0 2px;font-size:22px}
    p.lead{color:var(--muted);margin:0 0 12px}
    .row{display:flex;gap:10px}
    input[type="text"]{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit}
    button{padding:12px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),#ff582e);color:#051223;font-weight:700;cursor:pointer}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px;margin-top:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .channel{display:flex;gap:12px;align-items:center}
    .channel img{width:96px;height:96px;border-radius:12px;object-fit:cover}
    .meta .title{font-size:18px;margin-bottom:6px}
    .kv{color:var(--muted);font-size:13px}
    .stats{display:flex;gap:10px;margin-top:8px}
    .stat{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:10px;text-align:center}
    .stat .n{font-weight:700}
    .videos{margin-top:12px;display:grid;gap:10px}
    .video{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,0.01)}
    .video img{width:160px;height:90px;border-radius:8px;object-fit:cover}
    .video .info{flex:1}
    .badge{display:inline-block;background:rgba(255,255,255,0.04);padding:4px 8px;border-radius:999px;color:var(--muted);font-size:12px;margin-left:8px}
    .rec{padding:10px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.015),rgba(255,255,255,0.01));margin-top:8px}
    .small{font-size:13px;color:var(--muted)}
    .error{color:#ff9b9b}
    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
    .loader{display:inline-block;margin-left:8px;border:3px solid rgba(255,255,255,0.06);border-top:3px solid #fff;border-radius:50%;width:14px;height:14px;animation:spin 1s linear infinite;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:700px){ .row{flex-direction:column} .video img{width:120px;height:68px} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>YouTube Channel Audit</h1>
    <p class="lead">Paste channel URL / @handle / channel id / or video URL. (Client-side uses your API key.)</p>

    <div class="card">
      <div class="row">
        <input id="inp" type="text" placeholder="e.g. https://youtube.com/@gtx1050tifireflygaming?si=_eZKs2R_0dpIFlHh" />
        <button id="btn">Analyze</button>
      </div>
      <div style="margin-top:10px" class="small">
        <strong>Note:</strong> API key is used client-side — only for quick tests. For production, keep key server-side to avoid abuse.
      </div>
      <div id="status" class="small" style="margin-top:8px"></div>
    </div>

    <div id="out"></div>

    <footer>Built for you — paste & run. If a request fails, check API key quota or referrer restrictions.</footer>
  </div>

<script>
/*
  Single-file YouTube audit
  - Robust input parsing for many URL forms (handles ?si=, @handle, channel/, user/, video URL)
  - Uses YouTube Data API v3 client-side with API_KEY below
  - Fetches channel info, uploads playlist, video details, selects top 10 by views
  - Shows SEO/UX recommendations
*/

/* ---------- CONFIG: paste your API key here ---------- */
const API_KEY = "AIzaSyAI7S6lmMnAwDn0jTje_d1w_Qd9gQH_fAo"; // <-- your key (testing only)

/* ---------- UI refs ---------- */
const inp = document.getElementById('inp');
const btn = document.getElementById('btn');
const out = document.getElementById('out');
const status = document.getElementById('status');

btn.addEventListener('click', runAudit);
inp.addEventListener('keydown', e => { if (e.key === 'Enter') runAudit(); });

function setStatus(txt, loading=false, isError=false){
  status.innerHTML = txt + (loading? '<span class="loader"></span>':'');
  status.className = isError ? 'error small' : 'small';
}

function clearOutput(){ out.innerHTML = ''; }

/* ---------- Helpers ---------- */
function human(n){
  if (n === undefined || n === null) return '-';
  n = Number(n);
  if (isNaN(n)) return '-';
  if (n >= 1e9) return (n/1e9).toFixed(2)+'B';
  if (n >= 1e6) return (n/1e6).toFixed(1)+'M';
  if (n >= 1e3) return (n/1e3).toFixed(1)+'K';
  return n.toString();
}

function parseInput(input){
  input = (input||'').trim();
  if (!input) return { type: 'invalid' };

  // direct channel id: UC...
  if (/^UC[A-Za-z0-9_-]{20,}$/.test(input)) return { type:'channelId', id: input };

  // video id / watch?v= / youtu.be/
  let m = input.match(/(?:v=|youtu\.be\/|\/watch\/|\/embed\/)([A-Za-z0-9_-]{11})/);
  if (m) return { type:'videoId', id: m[1] };

  // channel URL: /channel/ID
  m = input.match(/youtube\.com\/channel\/([A-Za-z0-9_-]+)/i);
  if (m) return { type:'channelId', id: m[1] };

  // user URL: /user/NAME
  m = input.match(/youtube\.com\/user\/([^\/?\s]+)/i);
  if (m) return { type:'forUsername', id: m[1] };

  // handle: @handle in URL or plain @handle
  m = input.match(/@([A-Za-z0-9_]+)/);
  if (m) return { type:'handle', id: m[1] };

  // channel custom URL (youtube.com/c/Name) - use search fallback
  m = input.match(/youtube\.com\/c\/([^\/?\s]+)/i);
  if (m) return { type:'search', id: m[1] };

  // plain domainless handle or plain name: treat as search
  return { type:'search', id: input };
}

/* ---------- API wrappers ---------- */

async function apiGET(url){
  const res = await fetch(url);
  if (!res.ok) {
    const text = await res.text();
    throw new Error(`HTTP ${res.status}: ${text}`);
  }
  return res.json();
}

async function resolveChannelIdFromInput(input){
  const parsed = parseInput(input);
  if (parsed.type === 'invalid') throw new Error('Kuch daala hi nahi — channel URL / handle dalo.');
  if (parsed.type === 'channelId') return parsed.id;

  if (parsed.type === 'videoId') {
    // get video snippet -> channelId
    setStatus('Resolving channel from video id...', true);
    const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${parsed.id}&key=${API_KEY}`;
    const j = await apiGET(url);
    if (!j.items || j.items.length === 0) throw new Error('Video not found or private.');
    return j.items[0].snippet.channelId;
  }

  if (parsed.type === 'forUsername') {
    setStatus('Resolving channel by username...', true);
    const url = `https://www.googleapis.com/youtube/v3/channels?part=snippet&id&forUsername=${encodeURIComponent(parsed.id)}&key=${API_KEY}`;
    // Note: forUsername is a parameter to channels.list; browsers sometimes block, but we'll attempt search fallback if it fails.
    try {
      const j = await apiGET(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,contentDetails&forUsername=${encodeURIComponent(parsed.id)}&key=${API_KEY}`);
      if (j.items && j.items.length) return j.items[0].id;
    } catch(e){
      // fallback to search below
    }
    // fallback to search
    parsed.type = 'search';
  }

  if (parsed.type === 'handle' || parsed.type === 'search') {
    setStatus('Searching for channel (handle/name)...', true);
    // search for channel — search.list returns id.channelId in items[].id.channelId
    const q = encodeURIComponent(parsed.id.startsWith('@')? parsed.id : parsed.id);
    const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${q}&maxResults=5&key=${API_KEY}`;
    const j = await apiGET(url);
    if (!j.items || j.items.length === 0) throw new Error('Channel not found by search. Try full channel URL or exact handle (with @).');
    // prefer exact handle match if available
    for (const it of j.items) {
      const chId = it.id && (it.id.channelId || it.id.channelId);
      const title = it.snippet && it.snippet.channelTitle;
      const handleCandidate = it.snippet && it.snippet.customUrl;
      if (parsed.type === 'handle') {
        // match @handle to title or customUrl heuristically
        if (it.snippet && (it.snippet.customUrl && it.snippet.customUrl.toLowerCase() === parsed.id.toLowerCase()
            || ('@'+(it.snippet.customUrl||'')).toLowerCase() === ('@'+parsed.id).toLowerCase())) {
          if (chId) return chId;
        }
      }
    }
    // else return first result's channelId
    const first = j.items[0];
    if (first && first.id && first.id.channelId) return first.id.channelId;
    throw new Error('Unable to resolve channel id from search result.');
  }

  throw new Error('Unsupported input format.');
}

async function getChannelDetails(channelId){
  setStatus('Fetching channel details...', true);
  const url = `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,contentDetails&id=${channelId}&key=${API_KEY}`;
  const j = await apiGET(url);
  if (!j.items || !j.items.length) throw new Error('Channel details not found.');
  const ch = j.items[0];
  return {
    id: ch.id,
    title: ch.snippet.title,
    desc: ch.snippet.description || '',
    thumb: (ch.snippet.thumbnails && (ch.snippet.thumbnails.high || ch.snippet.thumbnails.default)) ? (ch.snippet.thumbnails.high?.url || ch.snippet.thumbnails.default?.url) : '',
    subs: ch.statistics.subscriberCount || 0,
    views: ch.statistics.viewCount || 0,
    uploadsPlaylist: ch.contentDetails && ch.contentDetails.relatedPlaylists && ch.contentDetails.relatedPlaylists.uploads
  };
}

async function fetchAllPlaylistVideoIds(playlistId, maxToFetch=200){
  if (!playlistId) return [];
  let ids = [];
  let pageToken = '';
  while (true) {
    setStatus(`Fetching playlist items (${ids.length} fetched)...`, true);
    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails&playlistId=${playlistId}&maxResults=50&key=${API_KEY}${pageToken?('&pageToken='+pageToken):''}`;
    const j = await apiGET(url);
    if (!j.items) break;
    for (const it of j.items) {
      if (it.contentDetails && it.contentDetails.videoId) ids.push(it.contentDetails.videoId);
      if (ids.length >= maxToFetch) break;
    }
    if (!j.nextPageToken || ids.length >= maxToFetch) break;
    pageToken = j.nextPageToken;
  }
  return ids;
}

async function fetchVideoDetailsBulk(videoIds){
  const details = [];
  // fetch in batches of 50
  for (let i=0;i<videoIds.length;i+=50){
    const batch = videoIds.slice(i,i+50);
    setStatus(`Fetching video details ${i+1} - ${i+batch.length}...`, true);
    const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,contentDetails&id=${batch.join(',')}&maxResults=50&key=${API_KEY}`;
    const j = await apiGET(url);
    if (j.items && j.items.length) {
      for (const v of j.items) {
        details.push({
          id: v.id,
          title: v.snippet.title,
          desc: v.snippet.description || '',
          thumb: (v.snippet.thumbnails && (v.snippet.thumbnails.medium || v.snippet.thumbnails.default)) ? (v.snippet.thumbnails.medium?.url || v.snippet.thumbnails.default?.url) : '',
          published: v.snippet.publishedAt,
          tags: v.snippet.tags || [],
          views: Number(v.statistics.viewCount || 0),
          likes: Number(v.statistics.likeCount || 0),
          comments: Number(v.statistics.commentCount || 0)
        });
      }
    }
  }
  return details;
}

/* ---------- Business logic / rendering ---------- */

function generateRecommendations(channel, topVideos){
  const recs = [];
  if (!channel.thumb) recs.push('Add a clear channel profile image for branding.');
  else recs.push('Channel profile image present — keep consistent brand colors.');

  if (!channel.desc || channel.desc.length < 80) recs.push('Write a 50–300 char channel description with 2–3 target keywords and links (schedule, socials).');
  else recs.push('Channel description OK — include a short tagline + links + upload schedule at top.');

  if (Number(channel.subs) > 0) {
    const subs = Number(channel.subs);
    const views = Number(channel.views) || 0;
    const ratio = views / Math.max(subs,1);
    if (ratio < 20) recs.push('Engagement seems low vs subscribers — add strong CTAs, pinned comment & end screens.');
    else recs.push('Engagement vs subscribers looks reasonable. Focus on retention & thumbnails.');
  }

  if (topVideos.length === 0){
    recs.push('No public videos found — check if uploads are private or the playlist is empty.');
    return recs;
  }

  // Video-specific quick tips (up to 6)
  for (let i=0;i<Math.min(topVideos.length,6);i++){
    const v = topVideos[i];
    if (v.title.length < 25) recs.push(`Title short: "${v.title}" — add descriptive keywords early in title.`);
    if ((v.desc||'').length < 100) recs.push(`Description short for "${v.title}" — add 2-line summary, links & 3 target keywords.`);
    if (!v.tags || v.tags.length === 0) recs.push(`Add tags for "${v.title}" (5–12 relevant tags).`);
  }

  recs.push('Thumbnail tips: use high contrast, readable text, big faces or central object; keep consistent style.');
  recs.push('SEO checklist: title with keyword early, first 1–2 lines of description keyword-rich, tags, chapters for long videos, subtitles/transcript.');
  recs.push('Use end screens & cards to promote playlists and increase session watch time.');

  return recs;
}

function render(channel, topVideos, recs){
  clearOutput();
  setStatus('Done', false);
  const wrap = document.createElement('div');

  // Channel card
  const chCard = document.createElement('div'); chCard.className='card';
  chCard.innerHTML = `
    <div class="channel">
      <img src="${channel.thumb || ''}" alt="thumb" onerror="this.style.display='none'"/>
      <div class="meta">
        <div class="title">${escapeHtml(channel.title)} <span class="badge">${channel.id}</span></div>
        <div class="kv">${escapeHtml(channel.desc ? channel.desc.slice(0,260) + (channel.desc.length>260?'…':'') : 'No description')}</div>
        <div class="stats">
          <div class="stat"><div class="n">${human(channel.subs)}</div><div class="kv">Subscribers</div></div>
          <div class="stat"><div class="n">${human(channel.views)}</div><div class="kv">Total views</div></div>
        </div>
      </div>
    </div>
  `;
  wrap.appendChild(chCard);

  // Top videos
  const vidCard = document.createElement('div'); vidCard.className='card';
  vidCard.innerHTML = `<h3>Top ${topVideos.length} videos (by views)</h3>`;
  const vlist = document.createElement('div'); vlist.className='videos';
  if (topVideos.length === 0) {
    vlist.innerHTML = `<div class="small">No public videos found.</div>`;
  } else {
    topVideos.forEach((v, idx) => {
      const vi = document.createElement('div'); vi.className='video';
      vi.innerHTML = `
        <img src="${v.thumb}" alt="thumb" onerror="this.style.display='none'"/>
        <div class="info">
          <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
            <a href="https://youtube.com/watch?v=${v.id}" target="_blank" style="font-weight:700;color:inherit;text-decoration:none">${idx+1}. ${escapeHtml(v.title)}</a>
            <span class="badge">${human(v.views)} views</span>
          </div>
          <div class="kv" style="margin-top:6px">Published: ${new Date(v.published).toLocaleDateString()}</div>
          <div class="kv">Tags: ${v.tags && v.tags.length ? escapeHtml(v.tags.slice(0,6).join(', ')) : '—'}</div>
        </div>
      `;
      vlist.appendChild(vi);
    });
  }
  vidCard.appendChild(vlist);
  wrap.appendChild(vidCard);

  // Recommendations
  const recCard = document.createElement('div'); recCard.className='card';
  recCard.innerHTML = `<h3>AI-style Recommendations & SEO Tips</h3>`;
  recs.forEach(r => {
    const el = document.createElement('div'); el.className='rec'; el.textContent = r;
    recCard.appendChild(el);
  });
  wrap.appendChild(recCard);

  out.appendChild(wrap);
}

function escapeHtml(s){
  if (!s) return '';
  return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

/* ---------- Main flow ---------- */
async function runAudit(){
  const val = inp.value.trim();
  if (!val) { alert('Please paste a YouTube channel URL, handle, or video link.'); return; }
  clearOutput();
  setStatus('Starting...', true);

  try {
    // resolve channel id
    const channelId = await resolveChannelIdFromInput(val);
    setStatus('Channel resolved: ' + channelId, true);

    // get channel details
    const channel = await getChannelDetails(channelId);

    // get video ids from uploads playlist (cap at 200 for speed/quota)
    if (!channel.uploadsPlaylist) {
      setStatus('No uploads playlist found; stopping.', false, true);
      out.innerHTML = '<div class="card error">Uploads playlist not available (maybe channel is new or private).</div>';
      return;
    }
    const videoIds = await fetchAllPlaylistVideoIds(channel.uploadsPlaylist, 200);

    // if no videos, render channel only
    if (!videoIds || videoIds.length === 0) {
      render(channel, [], generateRecommendations(channel, []));
      return;
    }

    // fetch video details
    const videoDetails = await fetchVideoDetailsBulk(videoIds);

    // sort by views and pick top 10
    const topVideos = videoDetails.sort((a,b)=>b.views - a.views).slice(0,10);

    // generate recommendations
    const recs = generateRecommendations(channel, topVideos);

    // render
    render(channel, topVideos, recs);

  } catch (err){
    console.error(err);
    clearOutput();
    setStatus('Error: ' + err.message, false, true);
    out.innerHTML = `<div class="card error">❌ Error: ${escapeHtml(err.message)}</div>`;
  }
}

/* ---------- initial focus ---------- */
inp.focus();

/* ---------- Optional: prefill the example URL the user gave (so they can click Analyze) ---------- */
inp.value = "https://youtube.com/@gtx1050tifireflygaming?si=_eZKs2R_0dpIFlHh";
</script>
</body>
</html>
