<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Website Earning Booster - Active User Traffic</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* --- CSS Styles --- */
  :root{
    --bg: #f6f8fb;--card: #ffffff;--muted: #6b7280; 
    --accent: #0f4f7f;--success: #059669; --border: #e5e7eb;
    --shadow: 0 8px 20px rgba(0,0,0,0.08);--radius: 12px;--gap: 16px; 
    --primary-blue: #0ea5e9;--danger: #dc2626;
  }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', system-ui; background: var(--bg); color: #111827; line-height: 1.5; }
  .wrap { max-width: 1400px; margin: 24px auto; padding: 12px; } 
  header { margin-bottom: 20px; text-align: center; }
  h1 { font-size: 30px; font-weight: 700; color: var(--accent); }
  h3 { font-size: 18px; margin-top: 20px; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 5px; }

  /* Controls */
  .controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; padding: 10px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--card); }
  .input-group { display: flex; gap: 10px; width: 100%; align-items: center; }
  .url-input-wrap { flex: 1; }
  .controls input[type="url"], .controls input[type="text"], .controls input[type="number"] { padding: 10px 15px; border: 1px solid var(--border); border-radius: 10px; font-size: 15px; width: 100%; transition: border-color 0.2s; }
  .controls input:focus { border-color: var(--primary-blue); outline: none; }
  .controls .btn { padding: 10px 20px; border: none; border-radius: 10px; background: var(--primary-blue); color: white; font-weight: 600; cursor: pointer; transition: background 0.2s; white-space: nowrap; }
  .controls .btn:hover { background: #0c8ccc; }
  .controls .btn:disabled { background: var(--muted); cursor: not-allowed; }

  .slot-selector { display: flex; align-items: center; gap: 5px; white-space: nowrap; font-weight: 600; color: var(--accent); }
  .slot-selector input[type="number"] { width: 60px; text-align: center; }
  
  /* Slot Containers */
  .slot-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--gap); }
  .slot { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: var(--gap); display: flex; flex-direction: column; gap: 10px; }
  .slot-header { display: flex; justify-content: space-between; align-items: center; }
  .slot h4 { margin: 0; font-size: 16px; color: var(--accent); }
  .status { font-size: 14px; padding: 5px 10px; border-radius: 8px; font-weight: 600; white-space: nowrap; }
  .status.idle { background: #fef3c7; color: #b45309; }
  .status.running { background: #dbeafe; color: #1e40af; }
  .status.success { background: #d1fae5; color: var(--success); }
  .status.failed { background: #fee2e2; color: var(--danger); }
  
  /* Proxy Input */
  .proxy-input-group { display: flex; gap: 5px; width: 100%; }
  .proxy-input-group input { flex: 1; border-radius: 8px; }
  
  /* Log/Frame */
  .log-frame { height: 200px; width: 100%; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); overflow-y: auto; padding: 10px; font-family: monospace; font-size: 12px; color: #374151; white-space: pre-wrap; }
  .log-frame p { margin: 0; line-height: 1.2; }
  
  /* Checkbox Controls */
  .repeat-control { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
  .repeat-control label { display: flex; align-items: center; gap: 5px; font-weight: 600; color: var(--muted); }
  
  /* Styling for Auto Clicker/Scroll */
  .slot .toggle-switch input { display: none; }
  .slot .toggle-switch .slider {
    cursor: pointer; width: 40px; height: 20px; background-color: var(--muted); border-radius: 10px; position: relative; transition: 0.4s;
  }
  .slot .toggle-switch .slider:before {
    position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; border-radius: 50%; transition: 0.4s;
  }
  .slot .toggle-switch input:checked + .slider { background-color: var(--success); }
  .slot .toggle-switch input:checked + .slider:before { transform: translateX(20px); }

</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Website Earning Booster Prime ðŸš€</h1>
    <p style="color: var(--muted);">Max Earning, AdSense Safe, Human-Like Traffic Tool (Tool 4 Fixes Applied)</p>
  </header>

  <div class="controls">
    <div class="input-group">
        <div class="slot-selector">
            Slots:
            <input id="numSlots" type="number" value="5" min="1" max="10" />
        </div>

        <div class="url-input-wrap">
            <input id="globalUrl" type="url" placeholder="Paste Target URL (e.g., https://yourwebsite.com)" />
        </div>
        <button id="globalGo" class="btn">Load & Run All</button>
        <button id="globalStop" class="btn" style="background: var(--danger); display: none;">Stop All</button>
    </div>
    
    <div class="input-group" style="margin-top: -10px;">
        <div class="url-input-wrap" style="flex: 1; border-radius: 10px;">
            <input id="gaIdInput" type="text" placeholder="GA4 Measurement ID (G-XXXXXXXXXX) - MANDATORY" style="border-radius: 10px; border-right: none;"/>
        </div>
        <div class="url-input-wrap" style="flex: 1; border-radius: 10px;">
            <input id="apiSecretInput" type="text" placeholder="GA4 API Secret - MANDATORY" style="border-radius: 10px; border-left: none;"/>
        </div>
    </div>
    <div class="repeat-control">
        <label>
            <input type="checkbox" id="autoClickerModeCheckbox" checked>
            <span style="color: var(--success);">MAX Earning Mode (Internal Click)</span>
        </label>
        <label>
            <input type="checkbox" id="repeatModeCheckbox">
            <span style="color: var(--primary-blue);">Repeat Mode (Auto-Run)</span>
        </label>
        <label>
            <input type="checkbox" id="autoScrollModeCheckbox">
            <span style="color: var(--muted);">Simulate Auto Scroll</span>
        </label>
    </div>
  </div>

  <h3>Automation Slots</h3>
  <div class="slot-container" id="slotContainer">
    </div>
</div>

<script>
// --- CONFIGURATION ---
const PROXY_ENDPOINT = '/proxy-request'; // Tool 4 endpoint
const numSlotsInput = document.getElementById('numSlots');
const slotContainer = document.getElementById('slotContainer');
const globalUrlInput = document.getElementById('globalUrl');
const globalGoBtn = document.getElementById('globalGo');
const globalStopBtn = document.getElementById('globalStop');
const repeatModeCheckbox = document.getElementById('repeatModeCheckbox');
const autoClickerModeCheckbox = document.getElementById('autoClickerModeCheckbox');
const autoScrollModeCheckbox = document.getElementById('autoScrollModeCheckbox');
const gaIdInput = document.getElementById('gaIdInput'); // NEW
const apiSecretInput = document.getElementById('apiSecretInput'); // NEW

let currentSlots = [];
let repeatIntervals = [];

// --- UTILITY FUNCTIONS ---
const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
const getRandomDelay = () => randomInt(30000, 40000); // 30s to 40s random delay for repeat (Human-like)

// CRITICAL FUNCTION: Builds the backend URL with all parameters
function getProxiedUrl(originalUrl, proxy){
    // Get values from the new GA4 input fields
    const gaId = gaIdInput.value.trim();
    const apiSecret = apiSecretInput.value.trim();

    const autoClickerEnabled = autoClickerModeCheckbox.checked ? '1' : '0';
    
    // Note: proxy.ip and proxy.port might be empty if running in VPN mode
    const ipParam = proxy.ip ? `ip=${proxy.ip}&port=${proxy.port}&` : '';
    const authParam = proxy.auth ? `auth=${proxy.auth}&` : '';

    return `${PROXY_ENDPOINT}?` + 
        `target=${encodeURIComponent(originalUrl)}&` + 
        ipParam + 
        authParam +
        `sessionDuration=30&` + 
        `clicker=${autoClickerEnabled}&` + // Pass the optional parameter
        `uid=${proxy.uniqueId}&` +
        `ga_id=${gaId}&` + // NEW: Pass GA4 ID
        `api_secret=${apiSecret}`; // NEW: Pass GA4 API Secret
}

// --- SLOT CLASS ---
class Slot {
    constructor(id) {
        this.id = id;
        this.element = null;
        this.isAutomationRunning = false;
        this.uniqueId = this.generateUniqueId();
        this.render();
    }

    generateUniqueId() {
        return 'user-' + Math.random().toString(36).substring(2, 10) + this.id;
    }

    render() {
        const slotDiv = document.createElement('div');
        slotDiv.className = `slot slot-${this.id}`;
        slotDiv.innerHTML = `
            <div class="slot-header">
                <h4>Slot ${this.id} (UID: ${this.uniqueId})</h4>
                <div class="status idle" id="status-${this.id}">IDLE</div>
            </div>
            <div class="input-group proxy-input-group">
                <input type="text" id="ip-${this.id}" placeholder="Proxy IP (Optional for VPN)" />
                <input type="number" id="port-${this.id}" placeholder="Port" style="width: 80px;" />
                <input type="text" id="auth-${this.id}" placeholder="Auth (user:pass)" />
            </div>
            <button class="btn" id="runBtn-${this.id}">Run Single</button>
            <button class="btn" id="stopBtn-${this.id}" style="background: var(--danger); display: none;">Stop</button>
            <div class="log-frame" id="log-${this.id}"></div>
        `;
        this.element = slotDiv;
        slotContainer.appendChild(slotDiv);
        
        // Attach event listeners
        document.getElementById(`runBtn-${this.id}`).addEventListener('click', () => this.handleRunClick());
        document.getElementById(`stopBtn-${this.id}`).addEventListener('click', () => this.handleStopClick());
    }

    // Toggles the scroll class on/off (Visual feedback for scroll simulation)
    toggleScrollClass(isEnabled) {
        this.element.classList.toggle('scrolling', isEnabled);
    }
    
    // Gets the current proxy configuration from the inputs
    getProxyConfig() {
        return {
            ip: document.getElementById(`ip-${this.id}`).value.trim(),
            port: document.getElementById(`port-${this.id}`).value.trim(),
            auth: document.getElementById(`auth-${this.id}`).value.trim(),
            uniqueId: this.uniqueId
        };
    }

    setStatus(message, isRunning = false) {
        const statusElement = document.getElementById(`status-${this.id}`);
        statusElement.textContent = message;
        statusElement.className = 'status ' + (isRunning ? 'running' : 'idle');
        
        const runBtn = document.getElementById(`runBtn-${this.id}`);
        const stopBtn = document.getElementById(`stopBtn-${this.id}`);
        
        if (isRunning) {
            runBtn.style.display = 'none';
            stopBtn.style.display = 'block';
        } else {
            runBtn.style.display = 'block';
            stopBtn.style.display = 'none';
        }
    }

    log(message, type = 'info') {
        const logFrame = document.getElementById(`log-${this.id}`);
        const p = document.createElement('p');
        p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        if (type === 'error') p.style.color = 'var(--danger)';
        if (type === 'success') p.style.color = 'var(--success)';
        logFrame.appendChild(p);
        logFrame.scrollTop = logFrame.scrollHeight; // Auto scroll to bottom
    }

    async runAutomation(url) {
        if (!url) {
            this.setStatus('FAILED');
            this.log('Error: Please enter a target URL.', 'error');
            return;
        }
        
        // CRITICAL: Check for GA4 mandatory fields
        if (!gaIdInput.value.trim() || !apiSecretInput.value.trim()) {
            this.setStatus('FAILED');
            this.log('Error: GA4 Measurement ID and API Secret are MANDATORY for AdSense Safety.', 'error');
            return;
        }

        this.isAutomationRunning = true;
        this.setStatus('RUNNING...');
        this.log(`Starting run for URL: ${url}`);
        this.log(`Max Earning Mode: ${autoClickerModeCheckbox.checked ? 'ON' : 'OFF'}`);
        this.log(`Using GA4 ID: ${gaIdInput.value.trim()}`);
        
        this.toggleScrollClass(autoScrollModeCheckbox.checked); // Start scroll simulation
        
        try {
            const proxy = this.getProxyConfig();
            const proxiedUrl = getProxiedUrl(url, proxy);
            
            const response = await fetch(proxiedUrl);
            const data = await response.json();
            
            this.toggleScrollClass(false); // Stop scroll simulation

            if (data.status === 'OK') {
                this.setStatus('SUCCESS', false);
                this.log(`Success! ${data.message}`, 'success');
                this.log(`GA4 Events Sent: ${data.eventsSent || 0}`, 'success');
            } else {
                this.setStatus('FAILED', false);
                this.log(`API Error: ${data.error || 'Unknown Error'}`, 'error');
                this.log(`Details: ${data.details || 'N/A'}`, 'error');
            }
        } catch (error) {
            this.toggleScrollClass(false); // Stop scroll simulation
            this.setStatus('FAILED', false);
            this.log(`Fetch Error: ${error.message}`, 'error');
        }
        
        this.isAutomationRunning = false;
        // If repeat mode is running, the interval will restart it, don't set status to idle here if repeat is active
        if (!repeatModeCheckbox.checked) {
             this.setStatus(this.element.querySelector('.status').textContent, false);
        }
    }

    handleRunClick() {
        const url = globalUrlInput.value.trim();
        this.runAutomation(url);
    }
    
    handleStopClick() {
        // Stop single slot only if repeat mode is not globally running
        this.setStatus('STOPPED', false);
        this.log('Automation manually stopped.', 'error');
        this.isAutomationRunning = false;
    }
}

function renderSlots(count) {
    slotContainer.innerHTML = '';
    currentSlots = [];
    for (let i = 1; i <= count; i++) {
        currentSlots.push(new Slot(i));
    }
}

function stopAllAutomation() {
    repeatIntervals.forEach(clearInterval);
    repeatIntervals = [];
    currentSlots.forEach(s => {
        s.setStatus('IDLE', false);
        s.log('Global Stop command received.', 'error');
        s.toggleScrollClass(false);
        s.isAutomationRunning = false;
    });
    globalGoBtn.style.display = 'block';
    globalStopBtn.style.display = 'none';
}

// --- GLOBAL ACTIONS ---
globalGoBtn.addEventListener('click', () => {
    const url = globalUrlInput.value.trim();
    
    if (!url) {
        alert("Please enter a Target URL.");
        return;
    }

    // CRITICAL: Check for GA4 mandatory fields on Global Run
    if (!gaIdInput.value.trim() || !apiSecretInput.value.trim()) {
        alert("GA4 Measurement ID and API Secret are MANDATORY for AdSense Safety. Please enter them.");
        return;
    }

    globalGoBtn.style.display = 'none';
    globalStopBtn.style.display = 'block';
    
    // Normal Run Mode
    if (!repeatModeCheckbox.checked) {
        currentSlots.forEach(s => {
            s.runAutomation(url);
        });
    } 
    // Repeat Mode
    else {
        // Stop any previous intervals just in case
        stopAllAutomation(); 
        
        currentSlots.forEach(s => {
            const fixedDelay = getRandomDelay(); 
            const delayInSeconds = (fixedDelay / 1000);

            s.setStatus(`Starting Repeat Mode (${delayInSeconds}s cycle)...`, true);
            
            // Immediately run the first time
            s.runAutomation(url); 
            
            // Set up the interval for subsequent runs
            const intervalId = setInterval(() => {
                s.runAutomation(url);
                s.setStatus(`Repeat Running. Next in ${Math.round(fixedDelay / 1000)}s...`, true);
            }, fixedDelay); 
            
            repeatIntervals.push(intervalId);
        });
    }
});


// Event listeners
numSlotsInput.addEventListener('change', (e) => {
    let count = parseInt(e.target.value);
    if (isNaN(count) || count < 1) count = 1; 
    renderSlots(count);
});

// Event listener for auto-scroll checkbox
autoScrollModeCheckbox.addEventListener('change', (e) => {
    // Toggles the scrolling class on all current slots when the checkbox changes
    const isScrolling = e.target.checked;
    currentSlots.forEach(s => {
        // Ensure that scrolling is only applied if it's checked
        s.toggleScrollClass(isScrolling);
    });
});


globalStopBtn.addEventListener('click', stopAllAutomation);

repeatModeCheckbox.addEventListener('change', () => {
    // Stop automation if repeat mode is unchecked while running
    if (!repeatModeCheckbox.checked && globalStopBtn.style.display === 'block') {
        stopAllAutomation();
    }
});


// Initial render when the page loads
renderSlots(parseInt(numSlotsInput.value));
</script>
</body>
</html>
