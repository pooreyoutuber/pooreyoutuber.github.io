<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PooreYouTuber Combined Tools</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f4f9; padding-top: 20px; }
        .container { background-color: #ffffff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card-header { background-color: #007bff; color: white; border-radius: 10px 10px 0 0; }
        h3 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        .log-box { background-color: #212529; color: #00ff41; height: 150px; overflow-y: scroll; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .slot-container { border: 1px solid #ddd; padding: 10px; margin-top: 15px; border-radius: 5px; }
        .slot-iframe { width: 100%; height: 150px; border: none; background-color: #e9ecef; }
        .slot-status { font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="text-center mb-4">PooreYouTuber Combined Tools API</h1>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="prime-tab" data-toggle="tab" href="#prime" role="tab" aria-controls="prime" aria-selected="true">Website Booster Prime (Proxy)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="mp-tab" data-toggle="tab" href="#mp-booster" role="tab" aria-controls="mp-booster" aria-selected="false">GA4 MP Booster (Background)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="gemini-tab" data-toggle="tab" href="#gemini-ai" role="tab" aria-controls="gemini-ai" aria-selected="false">Gemini AI Captions</a>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent" style="padding-top: 20px;">
        
        <div class="tab-pane fade show active" id="prime" role="tabpanel" aria-labelledby="prime-tab">
            <h3>üöÄ Website Booster Prime (Hybrid Traffic Tool)</h3>
            <p class="alert alert-info">Displays live views in slots. **Recommendation:** Fill in optional GA4 keys below for guaranteed Active User increase.</p>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="targetUrlPrime">Target URL (e.g., https://example.com)</label>
                        <input type="url" id="targetUrlPrime" class="form-control" placeholder="https://">
                    </div>
                    <div class="form-group">
                        <label for="proxyIpPrime">Proxy IP:Port (e.g., 142.111.48.253:7030)</label>
                        <input type="text" id="proxyIpPrime" class="form-control" placeholder="IP:Port">
                    </div>
                    <div class="form-group">
                        <label for="proxyAuthPrime">Proxy Auth (Username:Password)</label>
                        <input type="text" id="proxyAuthPrime" class="form-control" placeholder="user:pass">
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="slotsPrime">Number of Slots (1-10)</label>
                        <input type="number" id="slotsPrime" class="form-control" value="5" min="1" max="10">
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="form-group">
                                <label for="autoReloadPrime">Auto Reload (Seconds)</label>
                                <input type="number" id="autoReloadPrime" class="form-control" value="30" min="15">
                            </div>
                            <div class="form-group">
                                <label for="autoScrollPrime">Auto Scroll (Seconds)</label>
                                <input type="number" id="autoScrollPrime" class="form-control" value="10" min="5">
                            </div>
                        </div>

                        <div class="col-6">
                            <div class="form-group">
                                <label for="ga4IdPrime">Optional: GA4 Measurement ID</label>
                                <input type="text" id="ga4IdPrime" class="form-control" placeholder="G-XXXXXXXXX">
                            </div>
                            <div class="form-group">
                                <label for="apiKeyPrime">Optional: GA4 API Secret</label>
                                <input type="text" id="apiKeyPrime" class="form-control" placeholder="ABCDEFGHIJK_LMNOPQRSTUVWXYZ">
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success btn-block mt-3" onclick="runPrimeBooster()">Load & Run All Slots</button>
                    <button class="btn btn-danger btn-block mt-2" onclick="stopPrimeBooster()">Stop All Slots</button>
                </div>
            </div>

            <hr>
            <h4>Live Slots</h4>
            <div id="slotsContainer" class="row">
                </div>
            <div class="mt-3">
                <h5>Log:</h5>
                <div id="primeLog" class="log-box"></div>
            </div>
        </div>

        <div class="tab-pane fade" id="mp-booster" role="tabpanel" aria-labelledby="mp-tab">
            <h3>‚öôÔ∏è GA4 Measurement Protocol Booster (Background)</h3>
            <p class="alert alert-warning">This runs in the background for accurate GA4 reporting but does not display live views.</p>
            
            <div class="form-group">
                <label for="ga4Id">GA4 Measurement ID (e.g., G-XXXXXXXXX)</label>
                <input type="text" id="ga4Id" class="form-control" placeholder="G-XXXXXXXXX">
            </div>
            <div class="form-group">
                <label for="apiKey">API Secret (Generated in GA4 Stream)</label>
                <input type="text" id="apiKey" class="form-control" placeholder="ABCDEFGHIJK_LMNOPQRSTUVWXYZ">
            </div>
            <div class="form-group">
                <label for="views">Total Views to Generate (Max 500)</label>
                <input type="number" id="views" class="form-control" value="10" min="1" max="500">
            </div>

            <div class="mt-3">
                <label>Page Distribution (Total must equal 100%)</label>
                <div id="pageDistributionContainer">
                    <div class="row mb-2 page-input-row">
                        <div class="col-6"><input type="url" class="form-control page-url" placeholder="Page URL (e.g., /about)"></div>
                        <div class="col-4"><input type="number" class="form-control page-percent" value="100" min="0" max="100" placeholder="%"></div>
                        <div class="col-2"><button class="btn btn-danger btn-sm" onclick="removePageInput(this)">-</button></div>
                    </div>
                </div>
                <button class="btn btn-secondary btn-sm" onclick="addPageInput()">+ Add Page</button>
            </div>
            
            <div class="form-group mt-3">
                <label for="searchKeyword">Optional: Search Keyword (For Organic Traffic Simulation)</label>
                <input type="text" id="searchKeyword" class="form-control" placeholder="best gadgets 2024">
            </div>

            <button class="btn btn-primary btn-block" onclick="runMpBooster()">Start Background Booster</button>
            
            <div class="mt-3">
                <h5>Status:</h5>
                <p id="mpStatus" class="alert alert-light">Ready.</p>
            </div>
        </div>

        <div class="tab-pane fade" id="gemini-ai" role="tabpanel" aria-labelledby="gemini-tab">
            <h3>‚úçÔ∏è Gemini AI Caption Generator & Editor</h3>
            <div class="row">
                <div class="col-md-6">
                    <h4>Caption Generator</h4>
                    <div class="form-group">
                        <label for="reelTopic">Reel Topic/Description (e.g., Cat jumping in a box)</label>
                        <textarea id="reelTopic" class="form-control" rows="2" placeholder="Describe your reel content..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="captionStyle">Caption Style (e.g., Funny, Serious, Educational)</label>
                        <input type="text" id="captionStyle" class="form-control" placeholder="Funny and Viral">
                    </div>
                    <button class="btn btn-info btn-block" onclick="generateCaptions()">Generate Captions</button>
                </div>
                <div class="col-md-6">
                    <h4>Caption Editor</h4>
                    <div class="form-group">
                        <label for="originalCaption">Original Caption</label>
                        <textarea id="originalCaption" class="form-control" rows="3" placeholder="Paste caption here..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="requestedChange">Requested Change (e.g., Make it shorter, add more hashtags)</label>
                        <input type="text" id="requestedChange" class="form-control" placeholder="Make it sound professional.">
                    </div>
                    <button class="btn btn-secondary btn-block" onclick="editCaption()">Edit Caption</button>
                </div>
            </div>
            
            <div class="mt-4">
                <h5>Results:</h5>
                <pre id="captionResults" class="log-box" style="height: 300px; color: white; background-color: #343a40;">Ready to display results...</pre>
            </div>
        </div>

    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // NOTE: Replace this with your actual Render URL
    const serverUrl = 'https://pooreyoutuber-github-io-blmp.onrender.com'; // **YOUR RENDER URL HERE**
    const activeSlots = [];
    const MAX_SLOTS = 10;
    let timerInterval = null;

    // --- UTILITIES ---
    function generateUniqueId() {
        return 'uid-' + Math.random().toString(36).substring(2, 10) + Date.now().toString(36);
    }
    
    function logMessage(id, message, isPrime) {
        const logBox = document.getElementById(isPrime ? 'primeLog' : 'mpStatus');
        const timestamp = new Date().toLocaleTimeString();
        logBox.innerHTML += `[${timestamp}][${id}] ${message}\n`;
        logBox.scrollTop = logBox.scrollHeight;
    }

    // --- 1. PRIME BOOSTER LOGIC ---

    function runPrimeBooster() {
        if (activeSlots.length > 0) {
            logMessage('SYSTEM', 'Please stop existing slots first.', true);
            return;
        }

        const target = document.getElementById('targetUrlPrime').value.trim();
        const ip = document.getElementById('proxyIpPrime').value.trim();
        const auth = document.getElementById('proxyAuthPrime').value.trim();
        const slotsCount = parseInt(document.getElementById('slotsPrime').value);
        const autoReload = parseInt(document.getElementById('autoReloadPrime').value);
        
        // NEW: Fetching optional GA4 Keys
        const ga4Id = document.getElementById('ga4IdPrime').value.trim();
        const apiKey = document.getElementById('apiKeyPrime').value.trim();

        if (!target || !ip || !auth || !slotsCount || slotsCount < 1) {
            logMessage('SYSTEM', 'Target URL, Proxy IP:Port, and Auth are required.', true);
            return;
        }

        const container = document.getElementById('slotsContainer');
        container.innerHTML = ''; // Clear previous slots

        for (let i = 0; i < Math.min(slotsCount, MAX_SLOTS); i++) {
            const slotId = `slot-${i}`;
            const uid = generateUniqueId();
            
            // Create the slot HTML
            const slotHtml = `
                <div class="col-md-6 col-lg-4 mb-3" id="${slotId}-col">
                    <div class="slot-container">
                        <div class="slot-status">Slot ${i + 1}: <span id="${slotId}-status" class="text-warning">Loading...</span></div>
                        <iframe id="${slotId}-iframe" class="slot-iframe" src="about:blank"></iframe>
                        <div class="small mt-1 text-muted">Client ID: ${uid.substring(4)}...</div>
                    </div>
                </div>
            `;
            container.innerHTML += slotHtml;
            
            const slot = {
                id: slotId,
                uid: uid,
                target: target,
                ip: ip,
                port: ip.split(':')[1], // Extract port from IP:Port
                auth: auth,
                autoReload: autoReload * 1000,
                timer: null,
                ga4Id: ga4Id, // Passed to back-end
                apiKey: apiKey  // Passed to back-end
            };
            activeSlots.push(slot);
            startSlot(slot);
        }
        logMessage('SYSTEM', `Started ${activeSlots.length} slots in ${autoReload}s cycle.`, true);
    }

    function startSlot(slot) {
        if (slot.timer) clearTimeout(slot.timer);

        runBoosterCycle(slot);

        slot.timer = setInterval(() => {
            runBoosterCycle(slot);
        }, slot.autoReload);
    }
    
    // Core function to run one cycle of the booster
    async function runBoosterCycle(slot) {
        const statusElement = document.getElementById(`${slot.id}-status`);
        const iframeElement = document.getElementById(`${slot.id}-iframe`);
        
        statusElement.className = 'text-info';
        statusElement.innerText = 'Sending Request...';
        
        // 1. Prepare Request URL (Sending all data, including optional GA4 keys)
        const requestUrl = `${serverUrl}/proxy-request?` + new URLSearchParams({
            target: slot.target,
            ip: slot.ip,
            port: slot.port,
            auth: slot.auth,
            uid: slot.uid,
            ga_id: slot.ga4Id, // NEW: Sending optional GA4 ID
            api_key: slot.apiKey // NEW: Sending optional API Key
        }).toString();


        // 2. Perform the API Call
        try {
            const response = await fetch(requestUrl);
            const data = await response.json();

            if (response.ok && data.status === 'OK') {
                statusElement.className = 'text-success';
                statusElement.innerText = 'View Sent (BG Session Active)';
                logMessage(slot.id, `Success. Proxy status: ${data.proxy_status || 'CHECK'}. Next hit in ${slot.autoReload / 1000}s.`, true);
                
                // Load the target URL into the iframe for visual effect
                iframeElement.src = slot.target;
                
                // Trigger Auto Scroll (Example: Scroll down after 5 seconds)
                const scrollTime = parseInt(document.getElementById('autoScrollPrime').value) * 1000;
                if (scrollTime > 0) {
                     setTimeout(() => {
                        // Attempt to scroll the iframe content
                        try {
                            const iframeDoc = iframeElement.contentWindow.document;
                            iframeDoc.body.scrollTop = iframeDoc.body.scrollHeight / 2;
                            logMessage(slot.id, 'Scrolled halfway.', true);
                        } catch (e) {
                            logMessage(slot.id, 'Scroll blocked by CORS/Same-Origin Policy.', true);
                        }
                     }, scrollTime);
                }

            } else {
                statusElement.className = 'text-danger';
                statusElement.innerText = `Failed: ${data.details || data.message || 'Server Error'}`;
                logMessage(slot.id, `Failure: ${data.details || data.message}`, true);
                iframeElement.src = 'about:blank';
            }
        } catch (error) {
            statusElement.className = 'text-danger';
            statusElement.innerText = 'Critical Network Error';
            logMessage(slot.id, `Critical Network Error: ${error.message}`, true);
            iframeElement.src = 'about:blank';
        }
    }

    function stopPrimeBooster() {
        activeSlots.forEach(slot => {
            if (slot.timer) {
                clearInterval(slot.timer);
            }
            const statusElement = document.getElementById(`${slot.id}-status`);
            if (statusElement) {
                statusElement.className = 'text-danger';
                statusElement.innerText = 'Stopped';
            }
            const iframeElement = document.getElementById(`${slot.id}-iframe`);
            if (iframeElement) {
                iframeElement.src = 'about:blank';
            }
        });
        activeSlots.length = 0;
        logMessage('SYSTEM', 'All slots stopped.', true);
    }
    

    // --- 2. MP BOOSTER LOGIC (Existing Code) ---

    function addPageInput() {
        const container = document.getElementById('pageDistributionContainer');
        const newInput = `
            <div class="row mb-2 page-input-row">
                <div class="col-6"><input type="url" class="form-control page-url" placeholder="Page URL (e.g., /about)"></div>
                <div class="col-4"><input type="number" class="form-control page-percent" value="0" min="0" max="100" placeholder="%"></div>
                <div class="col-2"><button class="btn btn-danger btn-sm" onclick="removePageInput(this)">-</button></div>
            </div>
        `;
        container.innerHTML += newInput;
    }
    
    function removePageInput(button) {
        button.closest('.page-input-row').remove();
    }
    
    async function runMpBooster() {
        const ga4Id = document.getElementById('ga4Id').value.trim();
        const apiKey = document.getElementById('apiKey').value.trim();
        const views = document.getElementById('views').value.trim();
        const searchKeyword = document.getElementById('searchKeyword').value.trim();
        const statusElement = document.getElementById('mpStatus');

        const pages = [];
        let totalPercent = 0;
        document.querySelectorAll('.page-input-row').forEach(row => {
            const url = row.querySelector('.page-url').value.trim();
            const percent = parseFloat(row.querySelector('.page-percent').value);
            if (url && percent > 0) {
                pages.push({ url, percent });
                totalPercent += percent;
            }
        });
        
        if (!ga4Id || !apiKey || !views || pages.length === 0 || totalPercent < 99.9 || totalPercent > 100.1) {
            statusElement.className = 'alert alert-danger';
            statusElement.innerText = 'Missing GA keys, Views, or Page data. Total percentage must be 100%.';
            return;
        }

        statusElement.className = 'alert alert-warning';
        statusElement.innerText = 'Sending request to server...';

        try {
            const response = await fetch(`${serverUrl}/boost-mp`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ga_id: ga4Id, api_key: apiKey, views: views, pages: pages, search_keyword: searchKeyword })
            });

            const data = awai
