<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PooreYouTuber AI Insta Caption Tool</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #4CAF50; }
        .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
        .tab-button { padding: 10px 15px; cursor: pointer; border: none; background: #eee; border-radius: 5px 5px 0 0; margin-right: 5px; }
        .tab-button.active { background: #4CAF50; color: white; }
        .tab-content { padding: 15px; border: 1px solid #ddd; border-top: none; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input[type="text"], select, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; padding: 12px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 20px; width: 100%; }
        button:hover { background-color: #45a049; }
        .loading { text-align: center; color: #4CAF50; margin-top: 15px; display: none; }
        .results-box { margin-top: 25px; padding: 15px; background: #e9f5e9; border: 1px solid #4CAF50; border-radius: 4px; }
        .caption-item { background: white; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px; white-space: pre-wrap; word-wrap: break-word; }
        /* Style for the Edit Form */
        .edit-controls { margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>AI Instagram Caption Tool</h1>

    <div class="tabs">
        <button class="tab-button active" onclick="showTab('generate')">Caption Generate</button>
        <button class="tab-button" onclick="showTab('edit')">Caption Edit</button>
    </div>

    <div id="generate" class="tab-content">
        <h2>Generate New Captions</h2>
        <form id="generateForm">
            <label for="reelTitle">Reel Topic/Title:</label>
            <input type="text" id="reelTitle" placeholder="e.g., How to fix WordPress error 404" required>

            <label for="style">Caption Style:</label>
            <select id="style">
                <option value="Catchy and Funny">Catchy and Funny</option>
                <option value="Motivational and Inspiring">Motivational and Inspiring</option>
                <option value="Detailed and Informative">Detailed and Informative</option>
                <option value="Sarcastic and Witty">Sarcastic and Witty</option>
            </select>

            <button type="submit">Generate Captions</button>
        </form>
        <div id="generateLoading" class="loading">Loading... Please wait for AI generation.</div>
        <div id="generateResults" class="results-box"></div>
    </div>

    <div id="edit" class="tab-content" style="display:none;">
        <h2>Edit Existing Caption</h2>
        <form id="editForm">
            <label for="originalCaption">Original Caption & Hashtags:</label>
            <textarea id="originalCaption" rows="5" placeholder="Paste the caption you want to edit here..." required></textarea>

            <label for="requestedChange">Requested Change:</label>
            <input type="text" id="requestedChange" placeholder="e.g., Make it shorter and add an emoji, or Change the tone to professional" required>

            <button type="submit">Edit Caption</button>
        </form>
        <div id="editLoading" class="loading">Loading... AI is revising your caption.</div>
        <div id="editResults" class="results-box"></div>
    </div>

</div>

<script>
    // --------------------------------------------------------------------------------
    // --- IMPORTANT: RENDER API URL ---
    // Change this URL if your Render service address changes.
    // Your current Render URL: https://pooreyoutuber-github-io.onrender.com
    // --------------------------------------------------------------------------------
    const BASE_API_URL = 'https://pooreyoutuber-github-io.onrender.com'; 
    const GENERATE_ENDPOINT = `${BASE_API_URL}/api/caption-generate`;
    const EDIT_ENDPOINT = `${BASE_API_URL}/api/caption-edit`;


    // --- TAB SWITCHING LOGIC ---
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById(tabId).style.display = 'block';
        document.querySelector(`.tab-button[onclick*='${tabId}']`).classList.add('active');
    }
    showTab('generate'); // Default tab on load


    // --- 1. CAPTION GENERATION LOGIC ---
    document.getElementById('generateForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const reelTitle = document.getElementById('reelTitle').value;
        const style = document.getElementById('style').value;
        const resultsDiv = document.getElementById('generateResults');
        const loadingDiv = document.getElementById('generateLoading');

        resultsDiv.innerHTML = '';
        loadingDiv.style.display = 'block';

        try {
            const response = await fetch(GENERATE_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ reelTitle, style })
            });

            const data = await response.json();

            if (response.ok && data.captions) {
                let html = '<h3>Generated Captions:</h3>';
                data.captions.forEach(item => {
                    // The backend should return caption and 5 hashtags separated by a newline
                    html += `<div class="caption-item">${item.caption}</div>`;
                });
                resultsDiv.innerHTML = html;
            } else {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${data.error || 'Could not generate captions. Check server logs.'}</p>`;
            }
        } catch (error) {
            resultsDiv.innerHTML = `<p style="color: red;">Network Error: The API server might be sleeping or unreachable. Please try again or check the Render logs.</p>`;
        } finally {
            loadingDiv.style.display = 'none';
        }
    });

    // --- 2. CAPTION EDITING LOGIC ---
    document.getElementById('editForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const originalCaption = document.getElementById('originalCaption').value;
        const requestedChange = document.getElementById('requestedChange').value;
        const resultsDiv = document.getElementById('editResults');
        const loadingDiv = document.getElementById('editLoading');

        resultsDiv.innerHTML = '';
        loadingDiv.style.display = 'block';

        try {
            const response = await fetch(EDIT_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ originalCaption, requestedChange })
            });

            const data = await response.json();

            if (response.ok && data.editedCaption) {
                let html = '<h3>Edited Caption:</h3>';
                // The backend returns a single string with caption and hashtags
                html += `<div class="caption-item">${data.editedCaption}</div>`;
                resultsDiv.innerHTML = html;
            } else {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${data.error || 'Could not edit caption. Check server logs.'}</p>`;
            }
        } catch (error) {
            resultsDiv.innerHTML = `<p style="color: red;">Network Error: The API server might be sleeping or unreachable. Please try again or check the Render logs.</p>`;
        } finally {
            loadingDiv.style.display = 'none';
        }
    });

</script>
</body>
</html>
