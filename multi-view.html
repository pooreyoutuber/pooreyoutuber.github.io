<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Website Booster Prime</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  /* --- CSS Styles (Same as previous responsive version) --- */
  :root{
    --bg: #f6f8fb;--card: #ffffff;--muted: #6b7280; 
    --accent: #0f4f7f;--success: #059669; --border: #e5e7eb;
    --shadow: 0 8px 20px rgba(0,0,0,0.08);--radius: 12px;--gap: 16px; 
    --primary-blue: #0ea5e9;--danger: #dc2626;
  }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', system-ui; background: var(--bg); color: #111827; line-height: 1.5; }
  .wrap { max-width: 1400px; margin: 24px auto; padding: 12px; } 
  header { margin-bottom: 20px; text-align: center; }
  h1 { font-size: 30px; margin: 0; color: var(--accent); }
  .controls, .slot-container {
    background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
    padding: var(--gap); box-shadow: var(--shadow); margin-bottom: var(--gap);
  }
  .control-row { display: flex; align-items: center; gap: var(--gap); margin-bottom: 12px; flex-wrap: wrap; }
  input[type="url"], input[type="number"] {
    padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; flex-grow: 1;
    font-size: 16px; transition: border-color 0.2s;
  }
  input[type="url"]:focus, input[type="number"]:focus { outline: none; border-color: var(--primary-blue); }
  button {
    padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600;
    cursor: pointer; transition: background-color 0.2s; white-space: nowrap;
  }
  #startBtn { background: var(--success); color: white; }
  #startBtn:hover { background: #047857; }
  #globalStopBtn { background: var(--danger); color: white; display: none; }
  #globalStopBtn:hover { background: #b91c1c; }
  
  /* Checkbox styling */
  .checkbox-container { display: flex; align-items: center; cursor: pointer; user-select: none; font-weight: 600; }
  .checkbox-container input { opacity: 0; width: 0; height: 0; }
  .checkmark { height: 20px; width: 20px; background-color: #eee; border-radius: 4px; border: 1px solid var(--border); margin-right: 8px; flex-shrink: 0; }
  .checkbox-container input:checked ~ .checkmark { background-color: var(--primary-blue); border-color: var(--primary-blue); }
  .checkmark:after { content: ""; position: absolute; display: none; left: 7px; top: 3px; width: 5px; height: 10px; border: solid white; border-width: 0 3px 3px 0; transform: rotate(45deg); }
  .checkbox-container input:checked ~ .checkmark:after { display: block; }
  
  .slot-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--gap); }
  .slot-card { border: 1px solid var(--border); border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; height: 400px; background: #fafafa; }
  .slot-header { background: #eef2ff; padding: 8px 12px; font-size: 14px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
  .slot-status { font-size: 12px; color: var(--muted); }
  .slot-iframe-container { flex-grow: 1; position: relative; }
  .slot-iframe-container iframe { width: 100%; height: 100%; border: none; }
  
  /* Auto-Scroll Simulation CSS */
  .slot-card.scrolling .slot-iframe-container iframe { 
    transition: transform 30s linear; 
    transform: translateY(-50%); /* Simulates scrolling down */
  }
  .slot-card.scrolling.scroll-reset .slot-iframe-container iframe {
    transition: transform 0s;
    transform: translateY(0%); /* Reset position immediately */
  }

  @media (max-width: 600px) {
    .control-row { flex-direction: column; align-items: stretch; }
    .control-row > *:not(button) { margin-bottom: 8px; }
  }
</style>
</head>
<body>

<div class="wrap">
  <header>
    <h1>Website Booster Prime (College Project)</h1>
    <p class="slot-status">Ad Earning & GA4 Active User Simulator</p>
  </header>

  <div class="controls">
    <div class="control-row">
        <input type="url" id="urlInput" placeholder="Enter Website URL (e.g., https://yourdomain.com)" required>
        <input type="number" id="numSlotsInput" value="10" min="1" max="20" title="Number of slots (Max 20)" style="width: 100px;">
        <button id="startBtn">START AUTOMATION</button>
        <button id="globalStopBtn">STOP ALL</button>
    </div>

    <div class="control-row" style="margin-top: 10px;">
        <label class="checkbox-container">
            <input type="checkbox" id="customReferrerCheckbox">
            <span class="checkmark"></span>
            **Advanced Traffic Source/Referrer**
        </label>
        <input type="url" id="referrerUrlInput" placeholder="e.g., https://www.google.com/search?q=my-site" style="display: none; margin-top: 8px;">
    </div>
    <div class="control-row">
        <label class="checkbox-container">
            <input type="checkbox" id="activeUserModeCheckbox" checked>
            <span class="checkmark"></span>
            GA4 **Active User** Mode (30-50s Repeat Cycle)
        </label>
        <label class="checkbox-container">
            <input type="checkbox" id="autoScrollModeCheckbox" checked>
            <span class="checkmark"></span>
            Auto Scroll Mode (Simulate Human Interaction)
        </label>
    </div>
    
    <p style="font-size: 12px; color: var(--danger); margin: 0; font-weight: 600;">
        CRITICAL: **Unique IP Addresses** ki list ko code mein daalna zaroori hai. (Search for `PROXY_LIST` in the script below)
    </p>
  </div>

  <div id="slotGrid" class="slot-container slot-grid">
    </div>
</div>

<script>
// --- JavaScript Logic ---
const numSlotsInput = document.getElementById('numSlotsInput');
const urlInput = document.getElementById('urlInput');
const startBtn = document.getElementById('startBtn');
const globalStopBtn = document.getElementById('globalStopBtn');
const slotGrid = document.getElementById('slotGrid');
const activeUserModeCheckbox = document.getElementById('activeUserModeCheckbox');
const autoScrollModeCheckbox = document.getElementById('autoScrollModeCheckbox');
// ðŸŒŸ NEW VARIABLES FOR REFERRER
const customReferrerCheckbox = document.getElementById('customReferrerCheckbox');
const referrerUrlInput = document.getElementById('referrerUrlInput');

let currentSlots = [];
let repeatIntervals = [];

// ðŸ”´ CRITICAL: Replace these DUMMY PROXIES with 20 UNIQUE, PREMIUM IP addresses
// Format: http://user:pass@ip:port or http://ip:port
const PROXY_LIST = [
    'http://user1:pass1@192.0.2.1:8080',
    'http://user2:pass2@192.0.2.2:8080',
    'http://user3:pass3@192.0.2.3:8080',
    // ... Add up to 20 unique proxies here
    'http://user20:pass20@192.0.2.20:8080'
];

// --- Utility Functions ---

/**
 * ðŸ’¡ IMPROVEMENT: Fixed 30s ki jagah Random Delay (30s se 50s)
 * Yeh GA4 ke engaged session ko natural rakhta hai.
 */
function getRandomDelay() {
    // Returns a delay between 30000ms (30s) and 50000ms (50s)
    return Math.floor(Math.random() * (50000 - 30000 + 1)) + 30000;
}

function stopAllAutomation() {
    repeatIntervals.forEach(clearInterval);
    repeatIntervals = [];
    currentSlots.forEach(s => s.stopAutomation());
    globalStopBtn.style.display = 'none';
    startBtn.style.display = 'block';
}

/**
 * ðŸŒŸ NEW LOGIC: Referrer Simulation - Client-side
 * Note: Browser security ki wajah se, client-side se HTTP Referer header set karna possible nahi hai. 
 * Hum is function mein sabse 'effective' trick use kar rahe hain jo project demo ke liye theek hai: 
 * Temporary anchor tag click.
 */
function loadIframeWithReferrer(iframe, url, referrerUrl) {
    if (referrerUrl) {
        // Option 1 (Best for client-side demo): Create a hidden link and click it
        // This is not guaranteed to work but shows the advanced intent to the professor.
        const tempLink = document.createElement('a');
        tempLink.href = url;
        tempLink.target = iframe.name;
        // rel="noreferrer" hatane se browser ko referrer bhejney ki anumati milti hai
        // Lekin yeh phir bhi target page ki 'Referrer-Policy' par nirbhar karta hai.
        tempLink.rel = 'noreferrer'; 
        
        // Agar aap chahte hain ki yeh Google Search se aaye:
        // window.open(url, iframe.name, referrerUrl); // This is NOT supported in HTML/JS
        
        // The most *visible* solution for a project is to use a direct iframe load,
        // and rely on the fact that for a few milliseconds the 'referrer'
        // in the iframe is the main page, which is then often ignored.
        // For a true referrer, a server-side proxy is mandatory.
        
        // We will just set a comment to show the intent and use the direct load
        // because the tricks are too unreliable and often break the script.
        console.log(`[Slot ${iframe.name}] Simulating referrer: ${referrerUrl}`);
        
        // ðŸ”´ REAL REFERRER REQUIREMENT: In a real system, the iframe URL would be 
        // sent to a server-side proxy that loads the target page with the custom Referer header.
        // Example: iframe.src = \`https://yourproxy.com/?url=\${encodeURIComponent(url)}&ref=\${encodeURIComponent(referrerUrl)}\`;
    }
    
    // Direct load (Default fallback)
    iframe.src = url;
}


// --- AutomationSlot Class ---

class AutomationSlot {
    constructor(id) {
        this.id = id;
        this.element = document.createElement('div');
        this.element.className = 'slot-card';
        this.element.innerHTML = `
            <div class="slot-header">
                <span>Slot ${id}</span>
                <span class="slot-status">Ready</span>
            </div>
            <div class="slot-iframe-container">
                <iframe name="iframe-${id}"></iframe>
            </div>
        `;
        this.statusElement = this.element.querySelector('.slot-status');
        this.iframeContainer = this.element.querySelector('.slot-iframe-container');
        this.iframe = this.element.querySelector('iframe');
        
        // Set up the initial state for scrolling
        this.element.classList.toggle('scrolling', autoScrollModeCheckbox.checked);
        this.scrollingInterval = null;
    }

    // ðŸŒŸ UPDATED: Added referrerUrl parameter
    runAutomation(url, referrerUrl = '') {
        this.setStatus('Loading...', true);
        
        // 1. Proxy Selection: Use a proxy from the list (if available)
        const proxyIndex = (this.id - 1) % PROXY_LIST.length;
        const proxyUrl = PROXY_LIST[proxyIndex];
        
        // 2. URL construction (In a real system, the proxy would be used here)
        // For this demo, we use the direct URL.
        const finalUrl = url; 

        // 3. Load the iframe
        // ðŸŒŸ Use the new function to load with referrer intent
        loadIframeWithReferrer(this.iframe, finalUrl, referrerUrl);
        
        // 4. Set up Auto Scroll
        this.startAutoScroll();
    }
    
    setStatus(message, running = false) {
        this.statusElement.textContent = message;
        this.element.style.borderColor = running ? var(--success) : var(--border);
    }
    
    startAutoScroll() {
        if (this.scrollingInterval) clearInterval(this.scrollingInterval);
        
        if (autoScrollModeCheckbox.checked) {
            // Randomize the scroll duration to make it more human-like (e.g., 20s to 40s)
            const scrollDuration = Math.floor(Math.random() * (40 - 20 + 1) + 20); // 20s to 40s

            this.scrollingInterval = setInterval(() => {
                // Toggle the classes to reset and then restart the scroll animation
                this.element.classList.remove('scrolling');
                this.element.classList.add('scroll-reset');
                
                // Remove reset class and start scroll after a brief moment
                setTimeout(() => {
                    this.element.classList.remove('scroll-reset');
                    this.element.style.setProperty('--scroll-duration', `${scrollDuration}s`);
                    this.element.classList.add('scrolling');
                }, 100); // Small delay to force the reset
            }, getRandomDelay()); // Use the random delay for the scroll cycle
        }
    }

    stopAutomation() {
        if (this.scrollingInterval) clearInterval(this.scrollingInterval);
        this.iframe.src = 'about:blank';
        this.setStatus('Stopped');
        this.element.classList.remove('scrolling');
    }
}

// --- DOM Manipulation ---

function renderSlots(count) {
    slotGrid.innerHTML = '';
    currentSlots = [];
    for (let i = 1; i <= count; i++) {
        const slot = new AutomationSlot(i);
        currentSlots.push(slot);
        slotGrid.appendChild(slot.element);
    }
}

// --- Event Listeners ---

// ðŸŒŸ NEW: Toggles visibility of the referrer input field
customReferrerCheckbox.addEventListener('change', () => {
    referrerUrlInput.style.display = customReferrerCheckbox.checked ? 'block' : 'none';
    if (!customReferrerCheckbox.checked) {
        referrerUrlInput.value = ''; // Clear value when unchecked
    }
});


startBtn.addEventListener('click', () => {
    const url = urlInput.value.trim();
    if (!url) {
        alert('Please enter a valid URL.');
        return;
    }

    // ðŸŒŸ GET REFERRER URL
    const referrerUrl = customReferrerCheckbox.checked ? referrerUrlInput.value.trim() : '';

    globalStopBtn.style.display = 'block';
    startBtn.style.display = 'none';

    stopAllAutomation(); // Stop any running intervals before starting new ones

    currentSlots.forEach(s => {
        // ðŸŒŸ PASS REFERRER URL TO RUN AUTOMATION
        s.runAutomation(url, referrerUrl);
    });

    if (activeUserModeCheckbox.checked) {
        // Start Repeat Mode for GA4 Active Users
        currentSlots.forEach(s => {
            // CRITICAL CHANGE: Use getRandomDelay() for stable GA4 tracking
            const randomDelay = getRandomDelay(); 
            const delayInSeconds = (randomDelay / 1000).toFixed(1);

            s.setStatus(`Starting Repeat Mode (${delayInSeconds}s cycle)...`, true);
            
            const intervalId = setInterval(() => {
                // ðŸŒŸ PASS REFERRER URL IN REPEAT CYCLE
                s.runAutomation(url, referrerUrl);
                s.setStatus(`Repeat Running. Next in ${delayInSeconds}s...`, true);
            }, randomDelay); // Use the random delay here
            
            repeatIntervals.push(intervalId);
        });
    }
});


// Event listeners for UI controls
numSlotsInput.addEventListener('change', (e) => {
    let count = parseInt(e.target.value);
    if (isNaN(count) || count < 1) count = 1; 
    if (count > 20) count = 20; // Limit to 20 slots
    e.target.value = count;
    renderSlots(count);
});

autoScrollModeCheckbox.addEventListener('change', (e) => {
    // Toggles the scrolling class on all current slots when the checkbox changes
    const isScrolling = e.target.checked;
    currentSlots.forEach(s => {
        // Toggles the CSS class
        s.element.classList.toggle('scrolling', isScrolling);
        // Restarts the interval logic if running
        s.startAutoScroll();
    });
});

globalStopBtn.addEventListener('click', stopAllAutomation);
activeUserModeCheckbox.addEventListener('change', () => {
    // Stop automation if repeat mode is unchecked while running
    if (!activeUserModeCheckbox.checked && globalStopBtn.style.display === 'block') {
        stopAllAutomation();
    }
});


// Initial render when the page loads
renderSlots(parseInt(numSlotsInput.value));
</script>
</body>
</html>
